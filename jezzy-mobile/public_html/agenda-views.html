<!DOCTYPE html>
<html xmlns=”http://www.w3.org/1999/xhtml”>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Jezzy</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="img/icons/favicon.ico">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <script src="lib/agenda-views_files/moment.min.js"></script>
    <script src="lib/agenda-views_files/jquery.min.js"></script>
    <script src="lib/jquery-storage/jquery.cookie.js"></script>
    <script src="lib/jquery-storage/jquery.storageapi.min.js"></script>
    <script src="lib/jasny-bootstrap/js/jasny-bootstrap.min.js"></script>
    <script src="lib/agenda-views_files/fullcalendar.min.js"></script>
    <link rel="stylesheet" href="lib/jasny-bootstrap/css/jasny-bootstrap.min.css">
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <link href="lib/agenda-views_files/fullcalendar.css" rel="stylesheet">
    <link href="lib/agenda-views_files/fullcalendar.print.css" rel="stylesheet" media="print">
    <link rel="stylesheet" href="css/page/base.css">
    <link rel="stylesheet" href="css/page/calendar.css">
    <link rel="stylesheet" href="estilo/gwdpagedeck_style.css">
    <link rel="stylesheet" href="estilo/gwdpage_style.css">
    <script src="js/page/calendar.js"></script>
    <script src="js/page/configuracao.js"></script>
    <script src="estilo/googbase_min.js"></script>
    <script src="estilo/gwd_webcomponents_min.js"></script>
    <script src="estilo/gwdpage_min.js"></script>
    <script src="estilo/gwdpagedeck_min.js"></script>
    <script src="js/page/base.js"></script>
    <script src="js/page/moment.js"></script>
    <script src="js/page/jquery-confirm.min.js"></script>
    <link rel="stylesheet" href="css/page/jquery-confirm.min.css">
    <!--PUSHER MSG-->

    <script>
        var weekdays = [0,1,2,3,4,5,6];
        var dias = '';
        var diasfaltantes = '';
        var resultado2 = '';
        var voucher_id = '';
        var open_hour = '';
        var close_hour = '';
        var text = "";
        var servicetime = '';
        var serviceid = '';
        var endtimeformat = ' ';
        var servicevalue = ' ';
        var professional_id = ' ';
        var professional_id1 = ' ';
        var fileschedules = ' ';
        var str_open = '';
        var abertura = '';
        var str_close = '';
        var fechamento = '';
        var horaatual = moment().format('HH:mm:ss');
        open_hour = $.cookieStorage.get('Company').open_hour;
        var resultado = '';
        var eventbackgroundiscreated = false;
        //DETERMINA SE O BOTÃO DE DATA ANTERIOR VAI APARECER. ELE NÃO APARECE QUANDO A DATA EM QUE O CALENDARIO SE ENCONTRA É IGUAL A DE HOJE
        function verificaData() {

            var eventos2 = $('#calendar').fullCalendar( 'clientEvents' );


            eventbackgroundiscreated = false;
            for(var k =0;k<eventos2.length;k++){
                var events = eventos2[k].id;
                if(events == 'eventbackgroundblocklastdate'){
                    eventbackgroundiscreated = true;
                }else{

                }
            }


            var momento = $('#calendar').fullCalendar('getDate');
            var atual = new Date();

            var atualcalendar = new Date(momento);



           if(moment().format('D/MM/YYYY')==(moment(momento).format('D/MM/YYYY'))||moment(atualcalendar).add(1, 'days')._d < moment(atual)){
               document.getElementsByClassName('fc-left')[0].style.visibility='collapse';

           }else if(moment().format('D/MM/YYYY') != momento.format('D/MM/YYYY')){
               document.getElementsByClassName('fc-left')[0].style.visibility='visible';

           }


            if($.cookieStorage.get('Company').work_days != null){
                daystoshow = $.cookieStorage.get('Company').work_days;
                daystoshowname = daystoshow.split(",");
                dias = '';
                resultado='';
                var t =  atual.getDay();

                var meuarray = new Array;
                for(var b= 0;b<daystoshowname.length;b++){
                    meuarray[b] = daystoshowname[b];
                }

                var isBiggest = false;

                for(var i=0; i<daystoshowname.length;i++){
                    daystohide = daystoshowname[i];
                    switch (daystohide){
                        case 'dom':
                            daystohide = 0;
                            break;
                        case 'seg':
                            daystohide = 1;
                            break;
                        case 'ter':
                            daystohide = 2;
                            break;
                        case 'qua':
                            daystohide = 3;
                            break;
                        case 'qui':
                            daystohide = 4;
                            break;
                        case 'sex':
                            daystohide = 5;
                            break;
                        case 'sab':
                            daystohide = 6;
                            break;
                    }
                    dias += daystohide;



                }

                var tamanho = dias.length;

                for(var n=0;n<tamanho;n++){
                    if(n+1<tamanho){
                        resultado += (dias.substr([n],1)+",");
                    }else{
                        resultado += (dias.substr([n],1));
                    }

                }

                for(var c= 0;c<(resultado.split(',')).length;c++){
                    if(meuarray[c] > moment(momento).day()){
                        if((moment(momento).day() == meuarray[c])){

                            document.getElementsByClassName('fc-left')[0].style.visibility='collapse';
                        }

                        isBiggest = true;
                    }

                    if(isBiggest == false){








                            daystohide = meuarray[0];
                            switch (daystohide){
                                case 'dom':
                                    daystohide = 0;
                                    break;
                                case 'seg':
                                    daystohide = 1;
                                    break;
                                case 'ter':
                                    daystohide = 2;
                                    break;
                                case 'qua':
                                    daystohide = 3;
                                    break;
                                case 'qui':
                                    daystohide = 4;
                                    break;
                                case 'sex':
                                    daystohide = 5;
                                    break;
                                case 'sab':
                                    daystohide = 6;
                                    break;
                            }
                            dias = daystohide;


                        meuarray[0] = dias;
                        var falt = dias - moment().day();

                        if((moment(momento).day() == meuarray[0])){
                            if((moment().date())+falt == moment(momento).date()){
                                document.getElementsByClassName('fc-left')[0].style.visibility='collapse';
                            }
                        }
                    }
                }
            }


            if(open_hour<horaatual) {
                var agora = (moment(new Date));
                var agoramaisum = (moment(new Date)).add(1, 'h');
                var hj = (moment(new Date).format("YYYY-MM-DD"));
                if ((agora.minutes()/1)<30) {
                    var eventosTotal2 = new Array();
                    var dados2 = new Object();
                    var atual = new Date();
                    var month = (atual.getMonth() / 1) + 1;
                    var timeend = moment(hj + " "+ agora.hour()+":30:00");
                    var timestart = moment(hj + " "+ open_hour);
                    dados2.id = 'eventbackgroundblocklastdate';
                    dados2.title = 'HORÁRIO INDISPONÍVEL';
                    dados2.end = moment(timeend);
                    dados2.start = moment(timestart);
                    dados2.backgroundColor = '#444345';
                    dados2.borderColor = 'transparent';
                    dados2.color = '#2597AC';
                    dados2.allDay = false;
                    dados2.editable = false;
                    dados2.rendering = 'background';
                    eventosTotal2[0] = dados2;
                }else{

                    var eventosTotal2 = new Array();
                    var dados2 = new Object();
                    var atual = new Date();
                    var month = (atual.getMonth() / 1) + 1;
                    var timeend = moment(hj + " "+ moment(agoramaisum).hour());
                    var timestart = moment(hj + " "+ open_hour);
                    dados2.id = 'eventbackgroundblocklastdate';
                    dados2.title = 'HORÁRIO INDISPONÍVEL';
                    dados2.end = moment(timeend);
                    dados2.start = moment(timestart);
                    dados2.backgroundColor = '#444345';
                    dados2.borderColor = 'transparent';
                    dados2.color = '#2597AC';
                    dados2.allDay = false;
                    dados2.editable = false;
                    dados2.rendering = 'background';
                    eventosTotal2[0] = dados2;
                }




                for(var i = 0; i< eventosTotal2.length;i++){
                    if(eventbackgroundiscreated == false){
                        $('#calendar').fullCalendar('renderEvent', eventosTotal2[i]);
                        eventbackgroundiscreated = true;
                    }
                }


            }

        }
        //FIM DA VERIFICAÇÃO PARA O BOTÃO DE DATA ANTERIOR

        //CONVERSOR BASE64
        function unserialize (data) {
            //  discuss at: http://phpjs.org/functions/unserialize/
            // original by: Arpad Ray (mailto:arpad@php.net)
            // improved by: Pedro Tainha (http://www.pedrotainha.com)
            // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
            // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
            // improved by: Chris
            // improved by: James
            // improved by: Le Torbi
            // improved by: Eli Skeggs
            // bugfixed by: dptr1988
            // bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
            // bugfixed by: Brett Zamir (http://brett-zamir.me)
            //  revised by: d3x
            //    input by: Brett Zamir (http://brett-zamir.me)
            //    input by: Martin (http://www.erlenwiese.de/)
            //    input by: kilops
            //    input by: Jaroslaw Czarniak
            //        note: We feel the main purpose of this function should be to ease the transport of data between php & js
            //        note: Aiming for PHP-compatibility, we have to translate objects to arrays
            //   example 1: unserialize('a:3:{i:0;s:5:"Kevin";i:1;s:3:"van";i:2;s:9:"Zonneveld";}');
            //   returns 1: ['Kevin', 'van', 'Zonneveld']
            //   example 2: unserialize('a:3:{s:9:"firstName";s:5:"Kevin";s:7:"midName";s:3:"van";s:7:"surName";s:9:"Zonneveld";}');
            //   returns 2: {firstName: 'Kevin', midName: 'van', surName: 'Zonneveld'}

            var that = this,
                    utf8Overhead = function (chr) {
                        // http://phpjs.org/functions/unserialize:571#comment_95906
                        var code = chr.charCodeAt(0)
                        if (code < 0x0080 || 0x00A0 <= code && code <= 0x00FF || [338, 339, 352, 353, 376, 402, 8211, 8212, 8216, 8217,
                                    8218, 8220, 8221, 8222, 8224, 8225, 8226, 8230, 8240, 8364, 8482
                                ].indexOf(code) != -1) {
                            return 0
                        }
                        if (code < 0x0800) {
                            return 1
                        }
                        return 2
                    }
            error = function (type, msg, filename, line) {
                throw new that.window[type](msg, filename, line)
            }
            read_until = function (data, offset, stopchr) {
                var i = 2,
                        buf = [],
                        chr = data.slice(offset, offset + 1)

                while (chr != stopchr) {
                    if ((i + offset) > data.length) {
                        error('Error', 'Invalid')
                    }
                    buf.push(chr)
                    chr = data.slice(offset + (i - 1), offset + i)
                    i += 1
                }
                return [buf.length, buf.join('')]
            }
            read_chrs = function (data, offset, length) {
                var i, chr, buf

                buf = []
                for (i = 0; i < length; i++) {
                    chr = data.slice(offset + (i - 1), offset + i)
                    buf.push(chr)
                    length -= utf8Overhead(chr)
                }
                return [buf.length, buf.join('')]
            }
            _unserialize = function (data, offset) {
                var dtype, dataoffset, keyandchrs, keys, contig,
                        length, array, readdata, readData, ccount,
                        stringlength, i, key, kprops, kchrs, vprops,
                        vchrs, value, chrs = 0,
                        typeconvert = function (x) {
                            return x
                        }

                if (!offset) {
                    offset = 0
                }
                dtype = (data.slice(offset, offset + 1))
                        .toLowerCase()

                dataoffset = offset + 2

                switch (dtype) {
                    case 'i':
                        typeconvert = function (x) {
                            return parseInt(x, 10)
                        }
                        readData = read_until(data, dataoffset, ';')
                        chrs = readData[0]
                        readdata = readData[1]
                        dataoffset += chrs + 1
                        break
                    case 'b':
                        typeconvert = function (x) {
                            return parseInt(x, 10) !== 0
                        }
                        readData = read_until(data, dataoffset, ';')
                        chrs = readData[0]
                        readdata = readData[1]
                        dataoffset += chrs + 1
                        break
                    case 'd':
                        typeconvert = function (x) {
                            return parseFloat(x)
                        }
                        readData = read_until(data, dataoffset, ';')
                        chrs = readData[0]
                        readdata = readData[1]
                        dataoffset += chrs + 1
                        break
                    case 'n':
                        readdata = null
                        break
                    case 's':
                        ccount = read_until(data, dataoffset, ':')
                        chrs = ccount[0]
                        stringlength = ccount[1]
                        dataoffset += chrs + 2

                        readData = read_chrs(data, dataoffset + 1, parseInt(stringlength, 10))
                        chrs = readData[0]
                        readdata = readData[1]
                        dataoffset += chrs + 2
                        if (chrs != parseInt(stringlength, 10) && chrs != readdata.length) {
                            error('SyntaxError', 'String length mismatch')
                        }
                        break
                    case 'a':
                        readdata = {}

                        keyandchrs = read_until(data, dataoffset, ':')
                        chrs = keyandchrs[0]
                        keys = keyandchrs[1]
                        dataoffset += chrs + 2

                        length = parseInt(keys, 10)
                        contig = true

                        for (i = 0; i < length; i++) {
                            kprops = _unserialize(data, dataoffset)
                            kchrs = kprops[1]
                            key = kprops[2]
                            dataoffset += kchrs

                            vprops = _unserialize(data, dataoffset)
                            vchrs = vprops[1]
                            value = vprops[2]
                            dataoffset += vchrs

                            if (key !== i)
                                contig = false

                            readdata[key] = value
                        }

                        if (contig) {
                            array = new Array(length)
                            for (i = 0; i < length; i++)
                                array[i] = readdata[i]
                            readdata = array
                        }

                        dataoffset += 1
                        break
                    default:
                        error('SyntaxError', 'Unknown / Unhandled data type(s): ' + dtype)
                        break
                }
                return [dtype, dataoffset - offset, typeconvert(readdata)]
            }

            return _unserialize((data + ''), 0)[2]
        }
        var Base64 = {
            _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",
            encode: function (input) {
                var output = "";
                var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
                var i = 0;
                input = Base64._utf8_encode(input);
                while (i < input.length) {
                    chr1 = input.charCodeAt(i++);
                    chr2 = input.charCodeAt(i++);
                    chr3 = input.charCodeAt(i++);
                    enc1 = chr1 >> 2;
                    enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                    enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                    enc4 = chr3 & 63;
                    if (isNaN(chr2)) {
                        enc3 = enc4 = 64;
                    } else if (isNaN(chr3)) {
                        enc4 = 64;
                    }
                    output = output + this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) + this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);
                }
                return output;
            },
            decode: function (input) {
                var output = "";
                var chr1, chr2, chr3;
                var enc1, enc2, enc3, enc4;
                var i = 0;
                input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                while (i < input.length) {
                    enc1 = this._keyStr.indexOf(input.charAt(i++));
                    enc2 = this._keyStr.indexOf(input.charAt(i++));
                    enc3 = this._keyStr.indexOf(input.charAt(i++));
                    enc4 = this._keyStr.indexOf(input.charAt(i++));
                    chr1 = (enc1 << 2) | (enc2 >> 4);
                    chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                    chr3 = ((enc3 & 3) << 6) | enc4;
                    output = output + String.fromCharCode(chr1);
                    if (enc3 != 64) {
                        output = output + String.fromCharCode(chr2);
                    }
                    if (enc4 != 64) {
                        output = output + String.fromCharCode(chr3);
                    }
                }
                output = Base64._utf8_decode(output);
                return output;
            },
            _utf8_encode: function (string) {
                string = string.replace(/\r\n/g, "\n");
                var utftext = "";
                for (var n = 0; n < string.length; n++) {
                    var c = string.charCodeAt(n);
                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    }
                    else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                    else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                }
                return utftext;
            },
            _utf8_decode: function (utftext) {
                var string = "";
                var i = 0;
                var c = c1 = c2 = 0;
                while (i < utftext.length) {
                    c = utftext.charCodeAt(i);
                    if (c < 128) {
                        string += String.fromCharCode(c);
                        i++;
                    }
                    else if ((c > 191) && (c < 224)) {
                        c2 = utftext.charCodeAt(i + 1);
                        string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
                        i += 2;
                    }
                    else {
                        c2 = utftext.charCodeAt(i + 1);
                        c3 = utftext.charCodeAt(i + 2);
                        string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
                        i += 3;
                    }
                }
                return string;
            }
        };

        function sendRequest() {

            var query = "SELECT * FROM schedules WHERE user_id = " + $.cookieStorage.get('User').id + " and companie_id = " + company_id + " and secondary_user_id = "+professional_id1+" and status = 1";

            var conditions = {
                'General': {
                    'query': query
                }
            };
            var postData = JSON.stringify(conditions);

            postData = {
                'params': postData
            };
            var url = 'http://'+ip+'/api/General/get/query/' + createToken();

            $.ajax({
                method: "POST",
                url: url,
                data: postData

            }).done(function (result) {

                if (result == "ImE6MDp7fSI=") {

                    CreateCalendarEmpty();

                    if(open_hour<horaatual) {
                        var agora = (moment(new Date));
                        var agoramaisum = (moment(new Date)).add(1, 'h');
                        var hj = (moment(new Date).format("YYYY-MM-DD"));
                        if ((agora.minutes()/1)<30) {

                            var eventosTotal1 = new Array();
                            var dados1 = new Object();
                            var atual = new Date();
                            var month = (atual.getMonth() / 1) + 1;
                            var timeend = moment(hj + " "+ agora.hour()+":30:00");
                            var timestart = moment(hj + " "+ open_hour);
                            dados1.id = 'eventbackgroundblocklastdate';
                            dados1.title = 'HORÁRIO INDISPONÍVEL';
                            dados1.end = moment(timeend);
                            dados1.start = moment(timestart);
                            dados1.backgroundColor = '#444345';
                            dados1.borderColor = 'transparent';
                            dados1.color = '#2597AC';
                            dados1.allDay = false;
                            dados1.editable = false;
                            dados1.rendering = 'background';
                            eventosTotal1[0] = dados1;
                        }else{
                            var eventosTotal1 = new Array();
                            var dados1 = new Object();
                            var atual = new Date();
                            var month = (atual.getMonth() / 1) + 1;
                            var timeend = moment(hj + " "+ moment(agoramaisum).hour());
                            var timestart = moment(hj + " "+ open_hour);
                            dados1.id = 'eventbackgroundblocklastdate';
                            dados1.title = 'HORÁRIO INDISPONÍVEL';
                            dados1.end = moment(timeend);
                            dados1.start = moment(timestart);
                            dados1.backgroundColor = '#444345';
                            dados1.borderColor = 'transparent';
                            dados1.color = '#2597AC';
                            dados1.allDay = false;
                            dados1.editable = false;
                            dados1.rendering = 'background';
                            eventosTotal1[0] = dados1;
                        }




                        for(var i = 0; i< eventosTotal1.length;i++){
                            if(eventbackgroundiscreated == false){
                                $('#calendar').fullCalendar('renderEvent', eventosTotal1[i]);
                                eventbackgroundiscreated = true;
                            }

                        }


                    }
                    //SE NÃO RETORNAR NENHUM RESULTADO, CRIA-SE UM CALENDARIO SEM EVENTOS CONFIRMADOS
                    var query2 = "SELECT * FROM schedules WHERE user_id != " + $.cookieStorage.get('User').id + " and companie_id = " + company_id + ' and secondary_user_id ='+professional_id1+' and status = 1 ';

                    var conditions2 = {
                        'General': {
                            'query': query2
                        }
                    };
                    var postData2 = JSON.stringify(conditions2);

                    postData2 = {
                        'params': postData2
                    };
                    var url2 = 'http://'+ip+'/api/General/get/query/' + createToken();

                    $.ajax({
                        method: "POST",
                        url: url2,
                        data: postData2

                    }).done(function (result) {
                            if(result != "ImE6MDp7fSI=") {

                                var objReturns2 = JSON.parse(JSON.stringify(result));
                                var decodeObjReturns2 = Base64.decode(objReturns2);
                                var convertedReturns2 = unserialize(JSON.parse(decodeObjReturns2));

                             var eventosTotal2 = new Array();
                            for (var n = 0; n < convertedReturns2.length; n++) {
                            var evento2 = convertedReturns2[n];

                            var dados2 = new Object();
                            var timeend = moment(evento2.schedules.date + " " + evento2.schedules.time_end);
                            dados2.id = evento2.schedules.id;
                            dados2.title = 'HORÁRIO INDISPONÍVEL';
                            dados2.end = timeend;
                            dados2.start = moment(evento2.schedules.date + " " + evento2.schedules.time_begin);
                            dados2.backgroundColor = '#84827F';
                            dados2.borderColor = 'transparent';
                            dados2.color = '#84827F';
                            dados2.allDay = false;
                            dados2.editable = false;
                            eventosTotal2[n] = dados2;

                        }
                        // CRIA O CALENDARIO COM OS EVENTOS DE OUTROS USUARIOS.

                            createCalendar(eventosTotal2[0]);
                                if(open_hour<horaatual) {
                                    var agora = (moment(new Date));
                                    var agoramaisum = (moment(new Date)).add(1, 'h');
                                    var hj = (moment(new Date).format("YYYY-MM-DD"));
                                    if ((agora.minutes()/1)<30) {

                                        var eventosTotal1 = new Array();
                                        var dados1 = new Object();
                                        var atual = new Date();
                                        var month = (atual.getMonth() / 1) + 1;
                                        var timeend = moment(hj + " "+ agora.hour()+":30:00");
                                        var timestart = moment(hj + " "+ open_hour);
                                        dados1.id = 'eventbackgroundblocklastdate';
                                        dados1.title = 'HORÁRIO INDISPONÍVEL';
                                        dados1.end = moment(timeend);
                                        dados1.start = moment(timestart);
                                        dados1.backgroundColor = '#444345';
                                        dados1.borderColor = 'transparent';
                                        dados1.color = '#2597AC';
                                        dados1.allDay = false;
                                        dados1.editable = false;
                                        dados1.rendering = 'background';
                                        eventosTotal1[0] = dados1;
                                    }else{

                                        var eventosTotal1 = new Array();
                                        var dados1 = new Object();
                                        var atual = new Date();
                                        var month = (atual.getMonth() / 1) + 1;
                                        var timeend = moment(hj + " "+ moment(agoramaisum).hour());
                                        var timestart = moment(hj + " "+ open_hour);
                                        dados1.id = 'eventbackgroundblocklastdate';
                                        dados1.title = 'HORÁRIO INDISPONÍVEL';
                                        dados1.end = moment(timeend);
                                        dados1.start = moment(timestart);
                                        dados1.backgroundColor = '#444345';
                                        dados1.borderColor = 'transparent';
                                        dados1.color = '#2597AC';
                                        dados1.allDay = false;
                                        dados1.editable = false;
                                        dados1.rendering = 'background';
                                        eventosTotal1[0] = dados1;
                                    }




                                    for(var i = 0; i< eventosTotal1.length;i++){
                                        if(eventbackgroundiscreated == false){
                                            $('#calendar').fullCalendar('renderEvent', eventosTotal1[i]);
                                            eventbackgroundiscreated = true;
                                        }

                                    }


                                }

                            for (var i = 0; i < eventosTotal2.length; i++) {

                            $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);

                        }

                        //VERIFICA NA BASE DE DADOS O ID DO SERVIÇO DESSE ID DE SUBCLASSE
                        var query3 = "SELECT * FROM services WHERE subclasse_id = " + service_id;
                        var conditions3 = {
                            'General': {
                                'query': query3
                            }
                        };
                        var postData3 = JSON.stringify(conditions3);
                        postData3 = {
                            'params': postData3
                        };
                        var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();
                        $.ajax({
                            method: "POST",
                            url: url3,
                            data: postData3
                        }).done(function (result) {
                            if(result != "ImE6MDp7fSI=" ) {
                                var objReturns3 = JSON.parse(JSON.stringify(result));
                                var decodeObjReturns3 = Base64.decode(objReturns3);
                                var convertedReturns3 = unserialize(JSON.parse(decodeObjReturns3));
                                for (var i = 0; i < convertedReturns3.length; i++) {
                                    var servicetimes = convertedReturns3[i];
                                    servicetime = servicetimes.services.time;
                                    serviceid = servicetimes.services.id;
                                    servicevalue = servicetimes.services.value;
                                    servicename = servicetimes.services.name;

                                }
                                var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+"  and company_id = " + company_id;

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                       if(result!="ImE6MDp7fSI=" ){
                                    var objReturns4 = JSON.parse(JSON.stringify(result));
                                    var decodeObjReturns4 = Base64.decode(objReturns4);
                                    var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));

                                    var eventosTotal2 = new Array();

                                    var contador = 0;
                                    for (var j = 0; j < convertedReturns4.length; j++) {
                                        var evento2 = convertedReturns4[j];
                                        var dados2 = new Object();
                                        var horainicio =  (evento2.ScheduleSolicitation.time_begin).split(":");
                                        var horafim =  (evento2.ScheduleSolicitation.time_end).split(":");
                                        if (evento2.ScheduleSolicitation.status == "WAITING_COMPANY_RESPONSE") {
                                            dados2.id = evento2.ScheduleSolicitation.id;
                                            dados2.title = 'ESPERANDO RESPOSTA DO SALÃO';
                                            dados2.start = moment(evento2.ScheduleSolicitation.date + " " + horainicio[0]+":"+horainicio[1]);
                                            dados2.end = moment(evento2.ScheduleSolicitation.date + " " + horafim[0]+":"+horafim[1]);
                                            dados2.Color = 'rgba(36, 151, 172, 0.70)';
                                            dados2.backgroundColor = 'rgba(36, 151, 172, 0.70)';
                                            dados2.borderColor = 'transparent';
                                            dados2.allDay = false;
                                            dados2.editable = false;
                                            eventosTotal2[contador] = dados2;
                                            contador++;
                                        }

                                    }



                                    for (var i = 0; i < eventosTotal2.length; i++) {

                                        $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);

                                    }

                                       }
                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });

                            }
                        }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                            alert(errorThrown);
                        });

                        }else{
                                var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {

                                    if(result != "ImE6MDp7fSI="){


                                    var objReturns4 = JSON.parse(JSON.stringify(result));
                                    var decodeObjReturns4 = Base64.decode(objReturns4);
                                    var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                    var eventosTotal2 = new Array();

                                    var contador = 0;
                                    for (var j = 0; j < convertedReturns4.length; j++) {
                                        var evento2 = convertedReturns4[j];
                                        var dados2 = new Object();

                                        if (evento2.ScheduleSolicitation.status == "WAITING_COMPANY_RESPONSE") {
                                            dados2.id = evento2.ScheduleSolicitation.id;
                                            dados2.title = 'ESPERANDO RESPOSTA DO SALÃO';
                                            dados2.start = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_begin);
                                            dados2.end = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_end);
                                            dados2.Color = 'rgba(36, 151, 172, 0.70)';
                                            dados2.backgroundColor = 'rgba(36, 151, 172, 0.70)';
                                            dados2.borderColor = 'transparent';
                                            dados2.allDay = false;
                                            dados2.editable = false;
                                            eventosTotal2[contador] = dados2;
                                            contador++;
                                        }

                                    }


                                        createCalendar(eventosTotal2[0]);

                                        for (var i = 0; i < eventosTotal2.length; i++) {
                                            // INSERE EVENTO DE AGENDAMENTO N CONFIRMADO PELA COMPANIA
                                            $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);
                                        }


                                        if(open_hour<horaatual) {
                                            var agora = (moment(new Date));
                                            var agoramaisum = (moment(new Date)).add(1, 'h');
                                            var hj = (moment(new Date).format("YYYY-MM-DD"));
                                            var atual = new Date();
                                            if ((agora.minutes() / 1) < 30) {

                                                var eventosTotal1 = new Array();
                                                var dados1 = new Object();
                                                var timeend = moment(hj + " " + agora.hour() + ":30:00");
                                                var timestart = moment(hj + " " + open_hour);
                                                dados1.id = 'eventbackgroundblocklastdate';
                                                dados1.title = 'HORÁRIO INDISPONÍVEL';
                                                dados1.end = moment(timeend);
                                                dados1.start = moment(timestart);
                                                dados1.backgroundColor = '#444345';
                                                dados1.borderColor = 'transparent';
                                                dados1.color = '#2597AC';
                                                dados1.allDay = false;
                                                dados1.editable = false;
                                                dados1.rendering = 'background';
                                                eventosTotal1[0] = dados1;
                                            } else {

                                                var eventosTotal1 = new Array();
                                                var dados1 = new Object();
                                                var timeend = moment(hj + " " + moment(agoramaisum).hour());
                                                var timestart = moment(hj + " " + open_hour);
                                                dados1.id = 'eventbackgroundblocklastdate';
                                                dados1.title = 'HORÁRIO INDISPONÍVEL';
                                                dados1.end = moment(timeend);
                                                dados1.start = moment(timestart);
                                                dados1.backgroundColor = '#444345';
                                                dados1.borderColor = 'transparent';
                                                dados1.color = '#2597AC';
                                                dados1.allDay = false;
                                                dados1.editable = false;
                                                dados1.rendering = 'background';
                                                eventosTotal1[0] = dados1;
                                            }




                                            for(var i = 0; i< eventosTotal1.length;i++){
                                                if(eventbackgroundiscreated == false){
                                                    $('#calendar').fullCalendar('renderEvent', eventosTotal1[i]);
                                                    eventbackgroundiscreated = true;
                                                }

                                            }
                                        }



                                    }else{

                                        CreateCalendarEmpty();

                                        if(open_hour<horaatual) {
                                            var agora = (moment(new Date));
                                            var agoramaisum = (moment(new Date)).add(1, 'h');
                                            var hj = (moment(new Date).format("YYYY-MM-DD"));
                                            if ((agora.minutes()/1)<30) {

                                                var eventosTotal2 = new Array();
                                                var dados2 = new Object();
                                                var atual = new Date();
                                                var month = (atual.getMonth() / 1) + 1;
                                                var timeend = moment(hj + " "+ agora.hour()+":30:00");
                                                var timestart = moment(hj + " "+ open_hour);
                                                dados2.id = 'eventbackgroundblocklastdate';
                                                dados2.title = 'HORÁRIO INDISPONÍVEL';
                                                dados2.end = moment(timeend);
                                                dados2.start = moment(timestart);
                                                dados2.backgroundColor = '#444345';
                                                dados2.borderColor = 'transparent';
                                                dados2.color = '#2597AC';
                                                dados2.allDay = false;
                                                dados2.editable = false;
                                                dados2.rendering = 'background';
                                                eventosTotal2[0] = dados2;
                                            }else{

                                                var eventosTotal2 = new Array();
                                                var dados2 = new Object();
                                                var atual = new Date();
                                                var month = (atual.getMonth() / 1) + 1;
                                                var timeend = moment(hj + " "+ moment(agoramaisum).hour());
                                                var timestart = moment(hj + " "+ open_hour);
                                                dados2.id = 'eventbackgroundblocklastdate';
                                                dados2.title = 'HORÁRIO INDISPONÍVEL';
                                                dados2.end = moment(timeend);
                                                dados2.start = moment(timestart);
                                                dados2.backgroundColor = '#444345';
                                                dados2.borderColor = 'transparent';
                                                dados2.color = '#2597AC';
                                                dados2.allDay = false;
                                                dados2.editable = false;
                                                dados2.rendering = 'background';
                                                eventosTotal2[0] = dados2;
                                            }




                                            for(var i = 0; i< eventosTotal2.length;i++){
                                                if(eventbackgroundiscreated == false){
                                                    $('#calendar').fullCalendar('renderEvent', eventosTotal2[i]);
                                                    eventbackgroundiscreated = true;
                                                }

                                            }


                                        }

                                    }

                                 });
                            }

                    }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);
                    });


                } else {

                    //PEGA O OBJETO RETORNADO DA CONSULTA A BASE DE DADOS E CONVERTE PARA JSON
                    var objReturns = JSON.parse(JSON.stringify(result));
                    var decodeObjReturns = Base64.decode(objReturns);
                    var convertedReturns = unserialize(JSON.parse(decodeObjReturns));

                    var eventosTotal = new Array();
                    for (var n = 0; n < convertedReturns.length; n++) {
                        var evento = convertedReturns[n];
                        var dados = new Object();
                        dados.id = evento.schedules.id;
                        dados.title = evento.schedules.subclasse_name + ' - AGENDADO';
                        dados.end = moment(evento.schedules.date + " " + evento.schedules.time_end);
                        dados.start = moment(evento.schedules.date + " " + evento.schedules.time_begin);
                        dados.allDay = false;
                        dados.borderColor = 'transparent';
                        eventosTotal[n] = dados;

                    }
                    //CRIA UM CALENDÁRIO COM OS AGENDAMENTOS CONFIRMADOS PELA COMPANIA
                    createCalendar(eventosTotal[0]);

                    $('#calendar').fullCalendar('removeEvents');
                    if(open_hour<horaatual) {
                        var agora = (moment(new Date));
                        var agoramaisum = (moment(new Date)).add(1, 'h');
                        var hj = (moment(new Date).format("YYYY-MM-DD"));
                        if ((agora.minutes()/1)<30) {

                            var eventosTotal1 = new Array();
                            var dados1 = new Object();
                            var atual = new Date();
                            var month = (atual.getMonth() / 1) + 1;
                            var timeend = moment(hj + " "+ agora.hour()+":30:00");
                            var timestart = moment(hj + " "+ open_hour);
                            dados1.id = 'eventbackgroundblocklastdate';
                            dados1.title = 'HORÁRIO INDISPONÍVEL';
                            dados1.end = moment(timeend);
                            dados1.start = moment(timestart);
                            dados1.backgroundColor = '#444345';
                            dados1.borderColor = 'transparent';
                            dados1.color = '#2597AC';
                            dados1.allDay = false;
                            dados1.editable = false;
                            dados1.rendering = 'background';
                            eventosTotal1[0] = dados1;
                        }else{

                            var eventosTotal1 = new Array();
                            var dados1 = new Object();
                            var atual = new Date();
                            var month = (atual.getMonth() / 1) + 1;
                            var timeend = moment(hj + " "+ moment(agoramaisum).hour());
                            var timestart = moment(hj + " "+ open_hour);
                            dados1.id = 'eventbackgroundblocklastdate';
                            dados1.title = 'HORÁRIO INDISPONÍVEL';
                            dados1.end = moment(timeend);
                            dados1.start = moment(timestart);
                            dados1.backgroundColor = '#444345';
                            dados1.borderColor = 'transparent';
                            dados1.color = '#2597AC';
                            dados1.allDay = false;
                            dados1.editable = false;
                            dados1.rendering = 'background';
                            eventosTotal1[0] = dados1;
                        }




                        for(var i = 0; i< eventosTotal1.length;i++){
                            if(eventbackgroundiscreated == false){
                                $('#calendar').fullCalendar('renderEvent', eventosTotal1[i]);
                                eventbackgroundiscreated = true;
                            }

                        }


                    }
                    for (var i = 0; i < eventosTotal.length; i++) {
                        // INSERE EVENTO DE AGENDAMENTO CONFIRMADO PELA COMPANIA
                        $('#calendar').fullCalendar('renderEvent', eventosTotal[i], true);
                    }
                    // PEGA TODOS OS AGENDAMENTOS CONTIDOS NA BASE DE DADOS PARA OUTROS USUARIOS E ESSA COMPANIA
                    var query2 = "SELECT * FROM schedules WHERE user_id != " + $.cookieStorage.get('User').id + " and companie_id = " + company_id + ' and secondary_user_id = '+professional_id1+' and status = 1';

                    var conditions2 = {
                        'General': {
                            'query': query2
                        }
                    };
                    var postData2 = JSON.stringify(conditions2);

                    postData2 = {
                        'params': postData2
                    };
                    var url2 = 'http://'+ip+'/api/General/get/query/' + createToken();

                    $.ajax({
                        method: "POST",
                        url: url2,
                        data: postData2

                    }).done(function (result) {
                            if(result != "ImE6MDp7fSI=") {

                                var objReturns2 = JSON.parse(JSON.stringify(result));
                                var decodeObjReturns2 = Base64.decode(objReturns2);
                                var convertedReturns2 = unserialize(JSON.parse(decodeObjReturns2));


                                var eventosTotal2 = new Array();
                                for (var n = 0; n < convertedReturns2.length; n++) {
                                    var evento2 = convertedReturns2[n];

                                    var dados2 = new Object();


                                    dados2.id = evento2.schedules.id;
                                    dados2.title = 'HORÁRIO INDISPONÍVEL';
                                    dados2.end = moment(evento2.schedules.date + " " + evento2.schedules.time_end);
                                    dados2.start = moment(evento2.schedules.date + " " + evento2.schedules.time_begin);
                                    dados2.backgroundColor = '#84827F';
                                    dados2.color = '#84827F';
                                    dados2.borderColor = 'transparent';
                                    dados2.allDay = false;
                                    dados2.editable = false;

                                    eventosTotal2[n] = dados2;

                                }
                                // CRIA O CALENDARIO COM OS EVENTOS DE OUTROS USUARIOS SEM A OPÇÃO DE REMOVER EVENTO.

                                for (var i = 0; i < eventosTotal2.length; i++) {

                                    $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);
                                }


                                var query3 = "SELECT * FROM services WHERE subclasse_id = " + service_id;
                                var conditions3 = {
                                    'General': {
                                        'query': query3
                                    }
                                };
                                var postData3 = JSON.stringify(conditions3);
                                postData3 = {
                                    'params': postData3
                                };
                                var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();
                                $.ajax({
                                    method: "POST",
                                    url: url3,
                                    data: postData3
                                }).done(function (result) {

                                    var objReturns3 = JSON.parse(JSON.stringify(result));
                                    var decodeObjReturns3 = Base64.decode(objReturns3);
                                    var convertedReturns3 = unserialize(JSON.parse(decodeObjReturns3));
                                    for (var i = 0; i < convertedReturns3.length; i++) {
                                        var servicetimes = convertedReturns3[i];
                                        servicetime = servicetimes.services.time;
                                        serviceid = servicetimes.services.id;
                                        servicevalue = servicetimes.services.value;

                                    }

                                    var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                    var conditions4 = {
                                        'General': {
                                            'query': query4
                                        }
                                    };
                                    var postData4 = JSON.stringify(conditions4);

                                    postData4 = {
                                        'params': postData4
                                    };
                                    var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                    $.ajax({
                                        method: "POST",
                                        url: url4,
                                        data: postData4

                                    }).done(function (result) {

                                        if (result != "ImE6MDp7fSI=") {
                                            var objReturns4 = JSON.parse(JSON.stringify(result));
                                            var decodeObjReturns4 = Base64.decode(objReturns4);
                                            var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                            var eventosTotal2 = new Array();

                                            var contador = 0;
                                            for (var j = 0; j < convertedReturns4.length; j++) {
                                                var evento2 = convertedReturns4[j];
                                                var dados2 = new Object();

                                                if (evento2.ScheduleSolicitation.status == "WAITING_COMPANY_RESPONSE") {
                                                    dados2.id = evento2.ScheduleSolicitation.id;
                                                    dados2.title = 'ESPERANDO RESPOSTA DO SALÃO';
                                                    dados2.start = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_begin);
                                                    dados2.end = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_end);
                                                    dados2.Color = 'rgba(36, 151, 172, 0.70)';
                                                    dados2.backgroundColor = 'rgba(36, 151, 172, 0.70)';
                                                    dados2.borderColor = 'transparent';
                                                    dados2.allDay = false;
                                                    dados2.editable = false;
                                                    eventosTotal2[contador] = dados2;
                                                    contador++;
                                                }

                                            }


                                            for (var i = 0; i < eventosTotal2.length; i++) {

                                                $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);

                                            }
                                        }


                                    }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                        alert(errorThrown);
                                    });

                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });
                            }else{
                                var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {

                                    if (result != "ImE6MDp7fSI=") {
                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                        var eventosTotal2 = new Array();

                                        var contador = 0;
                                        for (var j = 0; j < convertedReturns4.length; j++) {
                                            var evento2 = convertedReturns4[j];
                                            var dados2 = new Object();

                                            if (evento2.ScheduleSolicitation.status == "WAITING_COMPANY_RESPONSE") {
                                                dados2.id = evento2.ScheduleSolicitation.id;
                                                dados2.title = 'ESPERANDO RESPOSTA DO SALÃO';
                                                dados2.start = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_begin);
                                                dados2.end = moment(evento2.ScheduleSolicitation.date + " " + evento2.ScheduleSolicitation.time_end);
                                                dados2.Color = 'rgba(36, 151, 172, 0.70)';
                                                dados2.backgroundColor = 'rgba(36, 151, 172, 0.70)';
                                                dados2.borderColor = 'transparent';
                                                dados2.allDay = false;
                                                dados2.editable = false;
                                                eventosTotal2[contador] = dados2;
                                                contador++;
                                            }

                                        }

                                        for (var i = 0; i < eventosTotal2.length; i++) {

                                            $('#calendar').fullCalendar('renderEvent', eventosTotal2[i], true);

                                        }
                                    }


                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });
                            }
                    }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown);
                    });
                }
            });
        }
        function CreateCalendarEmpty(){


            var domingo = '';
            var segunda = '';
            var terca = '';
            var quarta = '';
            var quinta = '';
            var sexta = '';
            var sabado = '';
            var separado = resultado2.split(',');
            if(separado[0]!= undefined){
                domingo = separado[0]/1;
            } if(separado[1]!= undefined){
                segunda = separado[1]/1;
            } if(separado[2]!= undefined){
                terca = separado[2]/1;
            }if(separado[3]!= undefined){
                quarta = separado[3]/1;
            } if(separado[4]!= undefined){
                quinta = separado[4]/1;
            } if(separado[5]!= undefined){
                sexta = separado[5]/1;
            } if(separado[6]!= undefined){
                sabado = separado[6]/1;
            }
            var defaultdate = moment(new Date);

            $('#calendar').fullCalendar({

                header: {
                    left: 'prev',
                    center:'title',
                    right:'next'
                },
                hiddenDays: [domingo, segunda, terca, quarta, quinta, sexta, sabado],
                defaultDate: defaultdate,
                selectable: true,
                selectHelper: true,
                slotEventOverlap:false,

                eventClick: function (event, element) {


                    if (event.title == "HORÁRIO INDISPONÍVEL") {

                        return false;
                    } else if ((event.title).match("AGENDADO")) {
                        $.confirm({
                            title: 'Cancelar agendamento de ' + subclass_name + '? Alterações que forem feitas não terão como ser mudadas',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {
                                event.title = "CANCELADO";
                                $('#calendar').fullCalendar('updateEvent', event);
                                $.alert({
                                    title: "",
                                    content: 'Agendamento Cancelado!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true
                                });

                                //CODIGO PARA MUDAR STATUS DE AGENDAMENTO CONCLUIDO PARA CANCELADO
                                var start = event.start;
                                var hora = start.toString().substr(16, 5);
                                var query11 = "SELECT * FROM schedules Schedules WHERE time_begin = '" + hora + "' and user_id = " + $.cookieStorage.get('User').id + " and secondary_user_id = "+professional_id1+" and companie_id = " + company_id;

                                var conditions3 = {
                                    'General': {
                                        'query': query11
                                    }
                                };
                                var postData3 = JSON.stringify(conditions3);

                                postData3 = {
                                    'params': postData3
                                };
                                var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url3,
                                    data: postData3

                                }).done(function (result) {

                                    if(result !='ImE6MDp7fSI='){
                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                        if(convertedReturns4[0].Schedules.voucher_id!=null&&convertedReturns4[0].Schedules.voucher_id!=0 ){
                                            var query3 = "UPDATE services_vouchers SET services_vouchers.status = 'APPROVED' WHERE services_vouchers.id = " + convertedReturns4[0].Schedules.voucher_id + ";";

                                            var conditions3 = {
                                                'General': {
                                                    'query': query3
                                                }
                                            };
                                            var postData3 = JSON.stringify(conditions3);

                                            postData3 = {
                                                'params': postData3
                                            };
                                            var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                            $.ajax({
                                                method: "POST",
                                                url: url3,
                                                data: postData3

                                            }).done(function (result) {
                                                if(result=='ImE6MDp7fSI='){


                                                var query3 = "UPDATE schedules Schedules SET status = 2 WHERE time_begin = '" + hora + "' and user_id = " + $.cookieStorage.get('User').id + " and companie_id = " + company_id;

                                                var conditions3 = {
                                                    'General': {
                                                        'query': query3
                                                    }
                                                };
                                                var postData3 = JSON.stringify(conditions3);

                                                postData3 = {
                                                    'params': postData3
                                                };
                                                var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                                $.ajax({
                                                    method: "POST",
                                                    url: url3,
                                                    data: postData3

                                                }).done(function (result) {



                                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                                    alert(errorThrown);
                                                });

                                                }
                                            }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                                alert(errorThrown);
                                            });
                                        }else{
                                            var query3 = "UPDATE schedules Schedules SET status = 2 WHERE time_begin = '" + hora + "' and user_id = " + $.cookieStorage.get('User').id + " and companie_id = " + company_id;

                                            var conditions3 = {
                                                'General': {
                                                    'query': query3
                                                }
                                            };
                                            var postData3 = JSON.stringify(conditions3);

                                            postData3 = {
                                                'params': postData3
                                            };
                                            var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                            $.ajax({
                                                method: "POST",
                                                url: url3,
                                                data: postData3

                                            }).done(function (result) {



                                            }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                                alert(errorThrown);
                                            });
                                        }


                                    }
                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });


                            },
                            cancel: function () {

                                $.alert({
                                    title: false,
                                    content: 'Cancelamento não foi realizado!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true

                                })

                            }
                        });
                    } else if (event.title == "CANCELADO") {
                        return false;
                    } else {

                        $.confirm({
                            title: 'Excluir solicitação de agendamento de ' + subclass_name + '?',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {
                                event.title = "Cancelado";
                                event.status = "CANCELED_BY_USER";
                                //REMOVER EVENTO
                                $('#calendar').fullCalendar('removeEvents', event.id);
                                $.alert({
                                    title: "",
                                    content: 'Solicitação excluida!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true
                                });
                                var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                    if (result != "ImE6MDp7fSI=") {
                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                        for (var j = 0; j < convertedReturns4.length; j++) {
                                            var cancelar = convertedReturns4[j].ScheduleSolicitation.time_begin;
                                            var user = convertedReturns4[j].ScheduleSolicitation.user_id;


                                            var start = event.start;
                                            var hora = start.toString().substr(16, 5);
                                            var data = start.toString().substr(0,15);
                                            var ano = data.substr(11,15);
                                            var mes =  data.substr(4,3);
                                            switch (mes) {
                                                case 'Jan' :
                                                    mes = "01";
                                                    break;
                                                case 'Fev' :
                                                    mes = "02";
                                                    break;
                                                case 'Mar' :
                                                    mes = "03";
                                                    break;
                                                case 'Abr' :
                                                    mes = "04";
                                                    break;
                                                case 'Mai' :
                                                    mes = "05";
                                                    break;
                                                case 'Jun' :
                                                    mes = "06";
                                                    break;
                                                case 'Jul' :
                                                    mes = "07";
                                                    break;
                                                case 'Ago' :
                                                    mes = "08";
                                                    break;
                                                case 'Set' :
                                                    mes = "09";
                                                    break;
                                                case 'Out' :
                                                    mes = "10";
                                                    break;
                                                case 'Nov' :
                                                    mes = "11";
                                                    break;
                                                case 'Dez' :
                                                    mes = "12";
                                                    break;
                                            }

                                            var dia = start.toString().substr(8,2);
                                            if (user == $.cookieStorage.get('User').id && cancelar == hora+":00") {
                                                var query4 = "UPDATE schedules_solicitation SET status = 'CANCELLED_BY_USER' WHERE time_begin ='"+hora+":00' and date ='"+ano+"-"+mes+"-"+dia+"' and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                                var conditions4 = {
                                                    'General': {
                                                        'query': query4
                                                    }
                                                };
                                                var postData4 = JSON.stringify(conditions4);

                                                postData4 = {
                                                    'params': postData4
                                                };
                                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                                $.ajax({
                                                    method: "POST",
                                                    url: url4,
                                                    data: postData4

                                                }).done(function (result) {
                                                    if (result != "ImE6MDp7fSI=") {
                                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));

                                                    }
                                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                                    alert(errorThrown);
                                                });
                                                //MUDAR STATUS DO ARQUIVO ARQUIVO DO BANCO DE DADOS

                                            }
                                        }
                                    }
                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });



                            },
                            cancel: function () {

                                $.alert({
                                    title: false,
                                    content: 'Operação Cancelada!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true

                                })

                            }

                        });

                    }

                },
                select: function (start, end) {
                    if(moment(start)>moment(new Date)){

                        var dia = start.toString().substr(4, 12);
                        var diaformat = dia.split(" ");
                        var day = diaformat[1];
                        var mes = diaformat[0];
                        var mesnumero = mes;
                        switch (mesnumero) {
                            case 'Jan' :
                                mesnumero = "01";
                                break;
                            case 'Fev' :
                                mesnumero = "02";
                                break;
                            case 'Mar' :
                                mesnumero = "03";
                                break;
                            case 'Abr' :
                                mesnumero = "04";
                                break;
                            case 'Mai' :
                                mesnumero = "05";
                                break;
                            case 'Jun' :
                                mesnumero = "06";
                                break;
                            case 'Jul' :
                                mesnumero = "07";
                                break;
                            case 'Ago' :
                                mesnumero = "08";
                                break;
                            case 'Set' :
                                mesnumero = "09";
                                break;
                            case 'Out' :
                                mesnumero = "10";
                                break;
                            case 'Nov' :
                                mesnumero = "11";
                                break;
                            case 'Dez' :
                                mesnumero = "12";
                                break;
                        }


                        switch (mes) {
                            case 'Jan' :
                                mes = "janeiro";
                                break;
                            case 'Fev' :
                                mes = "fevereiro";
                                break;
                            case 'Mar' :
                                mes = "março";
                                break;
                            case 'Abr' :
                                mes = "abril";
                                break;
                            case 'Mai' :
                                mes = "maio";
                                break;
                            case 'Jun' :
                                mes = "junho";
                                break;
                            case 'Jul' :
                                mes = "julho";
                                break;
                            case 'Ago' :
                                mes = "agosto";
                                break;
                            case 'Set' :
                                mes = "setembro";
                                break;
                            case 'Out' :
                                mes = "outubro";
                                break;
                            case 'Nov' :
                                mes = "novembro";
                                break;
                            case 'Dez' :
                                mes = "dezembro";
                                break;
                        }
                        var ano = diaformat[2];
                        var hora = start.toString().substr(16, 5);

                        var horastime = hora.substr(0, 2);

                        var minutestimes = hora.substr(3, 4);


                        var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                        var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                        var horastempo = Math.floor(minutostotais / 60);
                        var minutostempo = ((minutostotais % 60)).toFixed(2);
                        var str_minutos = new String(Math.floor(minutostempo));
                        if (str_minutos.length < 2) {
                            str_minutos = 0 + str_minutos;
                        }
                        var endtimeevent = (horastempo + ":" + str_minutos);
                        endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                        endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));

                        var title = $.confirm({
                            title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {

                                var eventData;
                                eventData = {
                                    title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                    start: start,
                                    end: endtimeformat,
                                    backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                    Color: 'rgba(36, 151, 172, 0.70)',
                                    borderColor: 'transparent',
                                    id: start
                                };


                                $('#calendar').fullCalendar('renderEvent', eventData, true);
                                var clientname = $.cookieStorage.get('User').name;
                                var clientid = $.cookieStorage.get('User').id;
                                var service = subclass_name;
                                var serviceid = subclass_id;
                                var minutes = eventData.start._d.getMinutes();
                                var hour = eventData.start._d.getUTCHours();

                                str_horas = new String(hour);
                                str_minutos = new String(minutes);

                                if (str_horas.length < 2) {
                                    hour = 0 + str_horas;
                                }
                                if (str_minutos.length < 2) {
                                    minutes = 0 + str_minutos;
                                }

                                var time = hour + ":" + minutes;
                                var month = new Array();
                                month[0] = '01';
                                month[1] = '02';
                                month[2] = '03';
                                month[3] = '04';
                                month[4] = '05';
                                month[5] = '06';
                                month[6] = '07';
                                month[7] = '08';
                                month[8] = '09';
                                month[9] = '10';
                                month[10] = '11';
                                month[11] = '12';
                                var n = month[eventData.start._d.getMonth()];
                                var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                var status = 'WAITING_COMPANY_RESPONSE';
                                var today = new Date();
                                var i = month[today.getMonth()];
                                var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                endtimeevent = endtimeevent.split(":");
                                var endvar = (endtimeevent[0] + ":");
                                var endmin = endtimeevent[1];
                                var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "','WAITING_COMPANY_RESPONSE'," + professional_id1 + ", " + voucher_id + ");";


                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                    //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                    if (result == "ImE6MDp7fSI=") {
                                        $.alert({
                                            title: "",
                                            content: 'Solicitação Enviada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });

                                    } else {
                                        $('#calendar').fullCalendar('unselect');
                                        $.alert({
                                            title: false,
                                            content: 'Solicitação não efetuada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });
                                    }
                                });
                            }
                        });
                    }else{

                    if(moment(start).hour()<(moment(new Date).hour())){
                        generateModalAlert("Horário Indisponível");
                        $('#mymodal').modal('show');

                    }else {

                        if (moment(start).hour() == (moment(new Date).hour())) {
                            if (moment(start).minutes()>(moment(new Date).minutes())) {

                                var dia = start.toString().substr(4, 12);
                                var diaformat = dia.split(" ");
                                var day = diaformat[1];
                                var mes = diaformat[0];
                                var mesnumero = mes;
                                switch (mesnumero) {
                                    case 'Jan' :
                                        mesnumero = "01";
                                        break;
                                    case 'Fev' :
                                        mesnumero = "02";
                                        break;
                                    case 'Mar' :
                                        mesnumero = "03";
                                        break;
                                    case 'Abr' :
                                        mesnumero = "04";
                                        break;
                                    case 'Mai' :
                                        mesnumero = "05";
                                        break;
                                    case 'Jun' :
                                        mesnumero = "06";
                                        break;
                                    case 'Jul' :
                                        mesnumero = "07";
                                        break;
                                    case 'Ago' :
                                        mesnumero = "08";
                                        break;
                                    case 'Set' :
                                        mesnumero = "09";
                                        break;
                                    case 'Out' :
                                        mesnumero = "10";
                                        break;
                                    case 'Nov' :
                                        mesnumero = "11";
                                        break;
                                    case 'Dez' :
                                        mesnumero = "12";
                                        break;
                                }


                                switch (mes) {
                                    case 'Jan' :
                                        mes = "janeiro";
                                        break;
                                    case 'Fev' :
                                        mes = "fevereiro";
                                        break;
                                    case 'Mar' :
                                        mes = "março";
                                        break;
                                    case 'Abr' :
                                        mes = "abril";
                                        break;
                                    case 'Mai' :
                                        mes = "maio";
                                        break;
                                    case 'Jun' :
                                        mes = "junho";
                                        break;
                                    case 'Jul' :
                                        mes = "julho";
                                        break;
                                    case 'Ago' :
                                        mes = "agosto";
                                        break;
                                    case 'Set' :
                                        mes = "setembro";
                                        break;
                                    case 'Out' :
                                        mes = "outubro";
                                        break;
                                    case 'Nov' :
                                        mes = "novembro";
                                        break;
                                    case 'Dez' :
                                        mes = "dezembro";
                                        break;
                                }
                                var ano = diaformat[2];
                                var hora = start.toString().substr(16, 5);

                                var horastime = hora.substr(0, 2);

                                var minutestimes = hora.substr(3, 4);


                                var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                                var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                                var horastempo = Math.floor(minutostotais / 60);
                                var minutostempo = ((minutostotais % 60)).toFixed(2);
                                var str_minutos = new String(Math.floor(minutostempo));
                                if (str_minutos.length < 2) {
                                    str_minutos = 0 + str_minutos;
                                }
                                var endtimeevent = (horastempo + ":" + str_minutos);
                                endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                                endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));
                                var title = $.confirm({
                                    title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                                    content: false,
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    confirmButton: 'Sim',
                                    cancelButton: 'Não',
                                    keyboardEnabled: true,

                                    confirm: function () {

                                        var eventData;
                                        eventData = {
                                            title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                            start: start,
                                            end: endtimeformat,
                                            backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                            Color: 'rgba(36, 151, 172, 0.70)',
                                            borderColor: 'transparent',
                                            id: start
                                        };

                                        $('#calendar').fullCalendar('renderEvent', eventData, true);
                                        var clientname = $.cookieStorage.get('User').name;
                                        var clientid = $.cookieStorage.get('User').id;
                                        var service = subclass_name;
                                        var serviceid = subclass_id;
                                        var minutes = eventData.start._d.getMinutes();
                                        var hour = eventData.start._d.getUTCHours();

                                        str_horas = new String(hour);
                                        str_minutos = new String(minutes);

                                        if (str_horas.length < 2) {
                                            hour = 0 + str_horas;
                                        }
                                        if (str_minutos.length < 2) {
                                            minutes = 0 + str_minutos;
                                        }

                                        var time = hour + ":" + minutes;
                                        var month = new Array();
                                        month[0] = '01';
                                        month[1] = '02';
                                        month[2] = '03';
                                        month[3] = '04';
                                        month[4] = '05';
                                        month[5] = '06';
                                        month[6] = '07';
                                        month[7] = '08';
                                        month[8] = '09';
                                        month[9] = '10';
                                        month[10] = '11';
                                        month[11] = '12';
                                        var n = month[eventData.start._d.getMonth()];
                                        var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                        var status = 'WAITING_COMPANY_RESPONSE';
                                        var today = new Date();
                                        var i = month[today.getMonth()];
                                        var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                        endtimeevent = endtimeevent.split(":");
                                        var endvar = " ";
                                        if (endtimeevent < 3) {
                                            endvar = (endtimeevent[0] + ":00:");
                                        } else {
                                            endvar = (endtimeevent[0] + ":" + endtimeevent[1] + ":");
                                        }
                                        var endmin = endtimeevent[1];
                                        var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "', 'WAITING_COMPANY_RESPONSE', " + professional_id1 + "," + voucher_id + " );";

                                        var conditions4 = {
                                            'General': {
                                                'query': query4
                                            }
                                        };
                                        var postData4 = JSON.stringify(conditions4);

                                        postData4 = {
                                            'params': postData4
                                        };
                                        var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                        $.ajax({
                                            method: "POST",
                                            url: url4,
                                            data: postData4

                                        }).done(function (result) {
                                            //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                            if (result == "ImE6MDp7fSI=") {
                                                $.alert({
                                                    title: "",
                                                    content: 'Solicitação Enviada!',
                                                    animation: 'zoom',
                                                    closeAnimation: 'scale',
                                                    animationBounce: 1.5,
                                                    theme: 'supervan',
                                                    closeIcon: false,
                                                    confirmButton: false,
                                                    backgroundDismiss: true
                                                });
                                                window.location.href("home.html")
                                            } else {
                                                $('#calendar').fullCalendar('unselect');
                                                $.alert({
                                                    title: false,
                                                    content: 'Solicitação não efetuada!',
                                                    animation: 'zoom',
                                                    closeAnimation: 'scale',
                                                    animationBounce: 1.5,
                                                    theme: 'supervan',
                                                    closeIcon: false,
                                                    confirmButton: false,
                                                    backgroundDismiss: true
                                                });
                                            }
                                        });
                                    }
                                });
                            }else{
                                generateModalAlert("Horário Indisponivel!");
                                $('#mymodal').modal('show');

                            }
                        } else {
                            var dia = start.toString().substr(4, 12);
                            var diaformat = dia.split(" ");
                            var day = diaformat[1];
                            var mes = diaformat[0];
                            var mesnumero = mes;
                            switch (mesnumero) {
                                case 'Jan' :
                                    mesnumero = "01";
                                    break;
                                case 'Fev' :
                                    mesnumero = "02";
                                    break;
                                case 'Mar' :
                                    mesnumero = "03";
                                    break;
                                case 'Abr' :
                                    mesnumero = "04";
                                    break;
                                case 'Mai' :
                                    mesnumero = "05";
                                    break;
                                case 'Jun' :
                                    mesnumero = "06";
                                    break;
                                case 'Jul' :
                                    mesnumero = "07";
                                    break;
                                case 'Ago' :
                                    mesnumero = "08";
                                    break;
                                case 'Set' :
                                    mesnumero = "09";
                                    break;
                                case 'Out' :
                                    mesnumero = "10";
                                    break;
                                case 'Nov' :
                                    mesnumero = "11";
                                    break;
                                case 'Dez' :
                                    mesnumero = "12";
                                    break;
                            }


                            switch (mes) {
                                case 'Jan' :
                                    mes = "janeiro";
                                    break;
                                case 'Fev' :
                                    mes = "fevereiro";
                                    break;
                                case 'Mar' :
                                    mes = "março";
                                    break;
                                case 'Abr' :
                                    mes = "abril";
                                    break;
                                case 'Mai' :
                                    mes = "maio";
                                    break;
                                case 'Jun' :
                                    mes = "junho";
                                    break;
                                case 'Jul' :
                                    mes = "julho";
                                    break;
                                case 'Ago' :
                                    mes = "agosto";
                                    break;
                                case 'Set' :
                                    mes = "setembro";
                                    break;
                                case 'Out' :
                                    mes = "outubro";
                                    break;
                                case 'Nov' :
                                    mes = "novembro";
                                    break;
                                case 'Dez' :
                                    mes = "dezembro";
                                    break;
                            }
                            var ano = diaformat[2];
                            var hora = start.toString().substr(16, 5);

                            var horastime = hora.substr(0, 2);

                            var minutestimes = hora.substr(3, 4);


                            var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                            var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                            var horastempo = Math.floor(minutostotais / 60);
                            var minutostempo = ((minutostotais % 60)).toFixed(2);
                            var str_minutos = new String(Math.floor(minutostempo));
                            if (str_minutos.length < 2) {
                                str_minutos = 0 + str_minutos;
                            }
                            var endtimeevent = (horastempo + ":" + str_minutos);
                            endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                            endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));

                            var title = $.confirm({
                                title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                                content: false,
                                animation: 'zoom',
                                closeAnimation: 'scale',
                                animationBounce: 1.5,
                                theme: 'supervan',
                                confirmButton: 'Sim',
                                cancelButton: 'Não',
                                keyboardEnabled: true,

                                confirm: function () {

                                    var eventData;
                                    eventData = {
                                        title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                        start: start,
                                        end: endtimeformat,
                                        backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                        Color: 'rgba(36, 151, 172, 0.70)',
                                        borderColor: 'transparent',
                                        id: start
                                    };


                                    $('#calendar').fullCalendar('renderEvent', eventData, true);
                                    var clientname = $.cookieStorage.get('User').name;
                                    var clientid = $.cookieStorage.get('User').id;
                                    var service = subclass_name;
                                    var serviceid = subclass_id;
                                    var minutes = eventData.start._d.getMinutes();
                                    var hour = eventData.start._d.getUTCHours();

                                    str_horas = new String(hour);
                                    str_minutos = new String(minutes);

                                    if (str_horas.length < 2) {
                                        hour = 0 + str_horas;
                                    }
                                    if (str_minutos.length < 2) {
                                        minutes = 0 + str_minutos;
                                    }

                                    var time = hour + ":" + minutes;
                                    var month = new Array();
                                    month[0] = '01';
                                    month[1] = '02';
                                    month[2] = '03';
                                    month[3] = '04';
                                    month[4] = '05';
                                    month[5] = '06';
                                    month[6] = '07';
                                    month[7] = '08';
                                    month[8] = '09';
                                    month[9] = '10';
                                    month[10] = '11';
                                    month[11] = '12';
                                    var n = month[eventData.start._d.getMonth()];
                                    var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                    var status = 'WAITING_COMPANY_RESPONSE';
                                    var today = new Date();
                                    var i = month[today.getMonth()];
                                    var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                    endtimeevent = endtimeevent.split(":");
                                    var endvar = (endtimeevent[0] + ":");
                                    var endmin = endtimeevent[1];
                                    var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "','WAITING_COMPANY_RESPONSE'," + professional_id1 + ", " + voucher_id + ");";


                                    var conditions4 = {
                                        'General': {
                                            'query': query4
                                        }
                                    };
                                    var postData4 = JSON.stringify(conditions4);

                                    postData4 = {
                                        'params': postData4
                                    };
                                    var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                    $.ajax({
                                        method: "POST",
                                        url: url4,
                                        data: postData4

                                    }).done(function (result) {
                                        //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                        if (result == "ImE6MDp7fSI=") {
                                            $.alert({
                                                title: "",
                                                content: 'Solicitação Enviada!',
                                                animation: 'zoom',
                                                closeAnimation: 'scale',
                                                animationBounce: 1.5,
                                                theme: 'supervan',
                                                closeIcon: false,
                                                confirmButton: false,
                                                backgroundDismiss: true
                                            });

                                        } else {
                                            $('#calendar').fullCalendar('unselect');
                                            $.alert({
                                                title: false,
                                                content: 'Solicitação não efetuada!',
                                                animation: 'zoom',
                                                closeAnimation: 'scale',
                                                animationBounce: 1.5,
                                                theme: 'supervan',
                                                closeIcon: false,
                                                confirmButton: false,
                                                backgroundDismiss: true
                                            });
                                        }
                                    });
                                }
                            });
                        }
                    }
                        }

                },



                minTime:abertura,
                maxTime:fechamento,
                //DEFINE SE OS FINAIS DE SEMANA SÃO SELECIONÁVEIS weekends:false,
                slotLabelFormat: 'H(:mm) a',
                allDaySlot:false,
                defaultView: 'agendaDay',
                editable: false,
                eventLimit: true

            });
            verificaData();
            $("#btnright-single-arrow").click(function (){
                verificaData();
            });
            $("#btnleft-single-arrow").click(function (){
                verificaData();


            });



        }
function createCalendar(text) {
    var domingo = '';
    var segunda = '';
    var terca = '';
    var quarta = '';
    var quinta = '';
    var sexta = '';
    var sabado = '';
    var separado = resultado2.split(',');
    if(separado[0]!= undefined){
        domingo = separado[0]/1;
    } if(separado[1]!= undefined){
        segunda = separado[1]/1;
    } if(separado[2]!= undefined){
        terca = separado[2]/1;
    }if(separado[3]!= undefined){
        quarta = separado[3]/1;
    } if(separado[4]!= undefined){
        quinta = separado[4]/1;
    } if(separado[5]!= undefined){
        sexta = separado[5]/1;
    } if(separado[6]!= undefined){
        sabado = separado[6]/1;
    }
    var defaultdate = moment(new Date);

    $('#calendar').fullCalendar({
        header: {
            left: 'prev',
            center: 'title',
            right: 'next'
        },
        hiddenDays: [domingo, segunda, terca, quarta, quinta, sexta, sabado],
        defaultDate: defaultdate,
        selectable: true,
        selectHelper: true,
        nowIndicator: true,
        eventClick: function (event, element) {


            if (event.title == "HORÁRIO INDISPONÍVEL") {

                return false;
            } else if ((event.title).match("AGENDADO")) {
                $.confirm({
                    title: 'Cancelar agendamento de ' + subclass_name + '? Alterações que forem feitas não terão como ser mudadas',
                    content: false,
                    animation: 'zoom',
                    closeAnimation: 'scale',
                    animationBounce: 1.5,
                    theme: 'supervan',
                    confirmButton: 'Sim',
                    cancelButton: 'Não',
                    keyboardEnabled: true,

                    confirm: function () {
                        event.title = "CANCELADO";
                        $('#calendar').fullCalendar('updateEvent', event);
                        $.alert({
                            title: "",
                            content: 'Agendamento Cancelado!',
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            closeIcon: false,
                            confirmButton: false,
                            backgroundDismiss: true
                        });

                        //CODIGO PARA MUDAR STATUS DE AGENDAMENTO CONCLUIDO PARA CANCELADO
                        var start = event.start;
                        var hora = start.toString().substr(16, 5);
                        var query3 = "UPDATE schedules SET status = 2 WHERE time_begin = '" + hora + "' and user_id = " + $.cookieStorage.get('User').id + " and companie_id = " + company_id;

                        var conditions3 = {
                            'General': {
                                'query': query3
                            }
                        };
                        var postData3 = JSON.stringify(conditions3);

                        postData3 = {
                            'params': postData3
                        };
                        var url3 = 'http://'+ip+'/api/General/get/query/' + createToken();

                        $.ajax({
                            method: "POST",
                            url: url3,
                            data: postData3

                        }).done(function (result) {


                        }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                            alert(errorThrown);
                        });
                    },
                    cancel: function () {

                        $.alert({
                            title: false,
                            content: 'Cancelamento não foi realizado!',
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            closeIcon: false,
                            confirmButton: false,
                            backgroundDismiss: true

                        })

                    }
                });
            } else if (event.title == "CANCELADO") {
                return false;
            } else {

                $.confirm({
                    title: 'Excluir solicitação de agendamento de ' + subclass_name + '?',
                    content: false,
                    animation: 'zoom',
                    closeAnimation: 'scale',
                    animationBounce: 1.5,
                    theme: 'supervan',
                    confirmButton: 'Sim',
                    cancelButton: 'Não',
                    keyboardEnabled: true,

                    confirm: function () {
                        event.title = "Cancelado";
                        event.status = "CANCELED_BY_USER";
                        //REMOVER EVENTO
                        $('#calendar').fullCalendar('removeEvents', event.id);
                        $.alert({
                            title: "",
                            content: 'Solicitação excluida!',
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            closeIcon: false,
                            confirmButton: false,
                            backgroundDismiss: true
                        });
                        var query4 = "SELECT * FROM schedules_solicitation ScheduleSolicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                        var conditions4 = {
                            'General': {
                                'query': query4
                            }
                        };
                        var postData4 = JSON.stringify(conditions4);

                        postData4 = {
                            'params': postData4
                        };
                        var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                        $.ajax({
                            method: "POST",
                            url: url4,
                            data: postData4

                        }).done(function (result) {
                            if (result != "ImE6MDp7fSI=") {
                                var objReturns4 = JSON.parse(JSON.stringify(result));
                                var decodeObjReturns4 = Base64.decode(objReturns4);
                                var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                for (var j = 0; j < convertedReturns4.length; j++) {
                                    var cancelar = convertedReturns4[j].ScheduleSolicitation.time_begin;
                                    var user = convertedReturns4[j].ScheduleSolicitation.user_id;


                                    var start = event.start;
                                    var hora = start.toString().substr(16, 5);
                                    var data = start.toString().substr(0,15);
                                    var ano = data.substr(11,15);
                                    var mes =  data.substr(4,3);
                                    switch (mes) {
                                        case 'Jan' :
                                            mes = "01";
                                            break;
                                        case 'Fev' :
                                            mes = "02";
                                            break;
                                        case 'Mar' :
                                            mes = "03";
                                            break;
                                        case 'Abr' :
                                            mes = "04";
                                            break;
                                        case 'Mai' :
                                            mes = "05";
                                            break;
                                        case 'Jun' :
                                            mes = "06";
                                            break;
                                        case 'Jul' :
                                            mes = "07";
                                            break;
                                        case 'Ago' :
                                            mes = "08";
                                            break;
                                        case 'Set' :
                                            mes = "09";
                                            break;
                                        case 'Out' :
                                            mes = "10";
                                            break;
                                        case 'Nov' :
                                            mes = "11";
                                            break;
                                        case 'Dez' :
                                            mes = "12";
                                            break;
                                    }

                                    var dia = start.toString().substr(8,2);
                                    if (user == $.cookieStorage.get('User').id && cancelar == hora+":00") {
                                        var query4 = "UPDATE schedules_solicitation SET status = 'CANCELLED_BY_USER' WHERE time_begin ='"+hora+":00' and date ='"+ano+"-"+mes+"-"+dia+"' and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                        var conditions4 = {
                                            'General': {
                                                'query': query4
                                            }
                                        };
                                        var postData4 = JSON.stringify(conditions4);

                                        postData4 = {
                                            'params': postData4
                                        };
                                        var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                        $.ajax({
                                            method: "POST",
                                            url: url4,
                                            data: postData4

                                        }).done(function (result) {
                                            if (result != "ImE6MDp7fSI=") {
                                                var objReturns4 = JSON.parse(JSON.stringify(result));
                                                var decodeObjReturns4 = Base64.decode(objReturns4);
                                                var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));

                                            }
                                        }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                            alert(errorThrown);
                                        });
                                        //MUDAR STATUS DO ARQUIVO ARQUIVO DO BANCO DE DADOS

                                    }
                                }
                            }
                        }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                           alert(errorThrown);
                        });



                    },
                    cancel: function () {

                        $.alert({
                            title: false,
                            content: 'Operação Cancelada!',
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            closeIcon: false,
                            confirmButton: false,
                            backgroundDismiss: true

                        })

                    }

                });

            }

        },
        select: function (start, end) {
            if(moment(start)>moment(new Date)){

                var dia = start.toString().substr(4, 12);
                var diaformat = dia.split(" ");
                var day = diaformat[1];
                var mes = diaformat[0];
                var mesnumero = mes;
                switch (mesnumero) {
                    case 'Jan' :
                        mesnumero = "01";
                        break;
                    case 'Fev' :
                        mesnumero = "02";
                        break;
                    case 'Mar' :
                        mesnumero = "03";
                        break;
                    case 'Abr' :
                        mesnumero = "04";
                        break;
                    case 'Mai' :
                        mesnumero = "05";
                        break;
                    case 'Jun' :
                        mesnumero = "06";
                        break;
                    case 'Jul' :
                        mesnumero = "07";
                        break;
                    case 'Ago' :
                        mesnumero = "08";
                        break;
                    case 'Set' :
                        mesnumero = "09";
                        break;
                    case 'Out' :
                        mesnumero = "10";
                        break;
                    case 'Nov' :
                        mesnumero = "11";
                        break;
                    case 'Dez' :
                        mesnumero = "12";
                        break;
                }


                switch (mes) {
                    case 'Jan' :
                        mes = "janeiro";
                        break;
                    case 'Fev' :
                        mes = "fevereiro";
                        break;
                    case 'Mar' :
                        mes = "março";
                        break;
                    case 'Abr' :
                        mes = "abril";
                        break;
                    case 'Mai' :
                        mes = "maio";
                        break;
                    case 'Jun' :
                        mes = "junho";
                        break;
                    case 'Jul' :
                        mes = "julho";
                        break;
                    case 'Ago' :
                        mes = "agosto";
                        break;
                    case 'Set' :
                        mes = "setembro";
                        break;
                    case 'Out' :
                        mes = "outubro";
                        break;
                    case 'Nov' :
                        mes = "novembro";
                        break;
                    case 'Dez' :
                        mes = "dezembro";
                        break;
                }
                var ano = diaformat[2];
                var hora = start.toString().substr(16, 5);

                var horastime = hora.substr(0, 2);

                var minutestimes = hora.substr(3, 4);


                var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                var horastempo = Math.floor(minutostotais / 60);
                var minutostempo = ((minutostotais % 60)).toFixed(2);
                var str_minutos = new String(Math.floor(minutostempo));
                if (str_minutos.length < 2) {
                    str_minutos = 0 + str_minutos;
                }
                var endtimeevent = (horastempo + ":" + str_minutos);
                endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));

                var title = $.confirm({
                    title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                    content: false,
                    animation: 'zoom',
                    closeAnimation: 'scale',
                    animationBounce: 1.5,
                    theme: 'supervan',
                    confirmButton: 'Sim',
                    cancelButton: 'Não',
                    keyboardEnabled: true,

                    confirm: function () {

                        var eventData;
                        eventData = {
                            title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                            start: start,
                            end: endtimeformat,
                            backgroundColor: 'rgba(36, 151, 172, 0.70)',
                            Color: 'rgba(36, 151, 172, 0.70)',
                            borderColor: 'transparent',
                            id: start
                        };


                        $('#calendar').fullCalendar('renderEvent', eventData, true);
                        var clientname = $.cookieStorage.get('User').name;
                        var clientid = $.cookieStorage.get('User').id;
                        var service = subclass_name;
                        var serviceid = subclass_id;
                        var minutes = eventData.start._d.getMinutes();
                        var hour = eventData.start._d.getUTCHours();

                        str_horas = new String(hour);
                        str_minutos = new String(minutes);

                        if (str_horas.length < 2) {
                            hour = 0 + str_horas;
                        }
                        if (str_minutos.length < 2) {
                            minutes = 0 + str_minutos;
                        }

                        var time = hour + ":" + minutes;
                        var month = new Array();
                        month[0] = '01';
                        month[1] = '02';
                        month[2] = '03';
                        month[3] = '04';
                        month[4] = '05';
                        month[5] = '06';
                        month[6] = '07';
                        month[7] = '08';
                        month[8] = '09';
                        month[9] = '10';
                        month[10] = '11';
                        month[11] = '12';
                        var n = month[eventData.start._d.getMonth()];
                        var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                        var status = 'WAITING_COMPANY_RESPONSE';
                        var today = new Date();
                        var i = month[today.getMonth()];
                        var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                        endtimeevent = endtimeevent.split(":");
                        var endvar = (endtimeevent[0] + ":");
                        var endmin = endtimeevent[1];
                        var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "','WAITING_COMPANY_RESPONSE'," + professional_id1 + ", " + voucher_id + ");";


                        var conditions4 = {
                            'General': {
                                'query': query4
                            }
                        };
                        var postData4 = JSON.stringify(conditions4);

                        postData4 = {
                            'params': postData4
                        };
                        var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                        $.ajax({
                            method: "POST",
                            url: url4,
                            data: postData4

                        }).done(function (result) {
                            //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                            if (result == "ImE6MDp7fSI=") {
                                $.alert({
                                    title: "",
                                    content: 'Solicitação Enviada!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true
                                });

                            } else {
                                $('#calendar').fullCalendar('unselect');
                                $.alert({
                                    title: false,
                                    content: 'Solicitação não efetuada!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true
                                });
                            }
                        });
                    }
                });
            }else{

            if(moment(start).hour()<(moment(new Date).hour())){
                generateModalAlert("Horário Indisponível!");
                $('#mymodal').modal('show');

            }else{
                if (moment(start).hour() == (moment(new Date).hour())) {
                    if (moment(start).minutes()>(moment(new Date).minutes())) {

                        var dia = start.toString().substr(4, 12);
                        var diaformat = dia.split(" ");
                        var day = diaformat[1];
                        var mes = diaformat[0];
                        var mesnumero = mes;
                        switch (mesnumero) {
                            case 'Jan' :
                                mesnumero = "01";
                                break;
                            case 'Fev' :
                                mesnumero = "02";
                                break;
                            case 'Mar' :
                                mesnumero = "03";
                                break;
                            case 'Abr' :
                                mesnumero = "04";
                                break;
                            case 'Mai' :
                                mesnumero = "05";
                                break;
                            case 'Jun' :
                                mesnumero = "06";
                                break;
                            case 'Jul' :
                                mesnumero = "07";
                                break;
                            case 'Ago' :
                                mesnumero = "08";
                                break;
                            case 'Set' :
                                mesnumero = "09";
                                break;
                            case 'Out' :
                                mesnumero = "10";
                                break;
                            case 'Nov' :
                                mesnumero = "11";
                                break;
                            case 'Dez' :
                                mesnumero = "12";
                                break;
                        }


                        switch (mes) {
                            case 'Jan' :
                                mes = "janeiro";
                                break;
                            case 'Fev' :
                                mes = "fevereiro";
                                break;
                            case 'Mar' :
                                mes = "março";
                                break;
                            case 'Abr' :
                                mes = "abril";
                                break;
                            case 'Mai' :
                                mes = "maio";
                                break;
                            case 'Jun' :
                                mes = "junho";
                                break;
                            case 'Jul' :
                                mes = "julho";
                                break;
                            case 'Ago' :
                                mes = "agosto";
                                break;
                            case 'Set' :
                                mes = "setembro";
                                break;
                            case 'Out' :
                                mes = "outubro";
                                break;
                            case 'Nov' :
                                mes = "novembro";
                                break;
                            case 'Dez' :
                                mes = "dezembro";
                                break;
                        }
                        var ano = diaformat[2];
                        var hora = start.toString().substr(16, 5);

                        var horastime = hora.substr(0, 2);

                        var minutestimes = hora.substr(3, 4);


                        var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                        var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                        var horastempo = Math.floor(minutostotais / 60);
                        var minutostempo = ((minutostotais % 60)).toFixed(2);
                        var str_minutos = new String(Math.floor(minutostempo));
                        if (str_minutos.length < 2) {
                            str_minutos = 0 + str_minutos;
                        }
                        var endtimeevent = (horastempo + ":" + str_minutos);
                        endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                        endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));
                        var title = $.confirm({
                            title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {

                                var eventData;
                                eventData = {
                                    title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                    start: start,
                                    end: endtimeformat,
                                    backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                    Color: 'rgba(36, 151, 172, 0.70)',
                                    borderColor: 'transparent',
                                    id: start
                                };

                                $('#calendar').fullCalendar('renderEvent', eventData, true);
                                var clientname = $.cookieStorage.get('User').name;
                                var clientid = $.cookieStorage.get('User').id;
                                var service = subclass_name;
                                var serviceid = subclass_id;
                                var minutes = eventData.start._d.getMinutes();
                                var hour = eventData.start._d.getUTCHours();

                                str_horas = new String(hour);
                                str_minutos = new String(minutes);

                                if (str_horas.length < 2) {
                                    hour = 0 + str_horas;
                                }
                                if (str_minutos.length < 2) {
                                    minutes = 0 + str_minutos;
                                }

                                var time = hour + ":" + minutes;
                                var month = new Array();
                                month[0] = '01';
                                month[1] = '02';
                                month[2] = '03';
                                month[3] = '04';
                                month[4] = '05';
                                month[5] = '06';
                                month[6] = '07';
                                month[7] = '08';
                                month[8] = '09';
                                month[9] = '10';
                                month[10] = '11';
                                month[11] = '12';
                                var n = month[eventData.start._d.getMonth()];
                                var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                var status = 'WAITING_COMPANY_RESPONSE';
                                var today = new Date();
                                var i = month[today.getMonth()];
                                var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                endtimeevent = endtimeevent.split(":");
                                var endvar = " ";
                                if (endtimeevent < 3) {
                                    endvar = (endtimeevent[0] + ":00:");
                                } else {
                                    endvar = (endtimeevent[0] + ":" + endtimeevent[1] + ":");
                                }
                                var endmin = endtimeevent[1];
                                var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "', 'WAITING_COMPANY_RESPONSE', " + professional_id1 + "," + voucher_id + " );";

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                    //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                    if (result == "ImE6MDp7fSI=") {
                                        $.alert({
                                            title: "",
                                            content: 'Solicitação Enviada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });
                                        window.location.href("home.html")
                                    } else {
                                        $('#calendar').fullCalendar('unselect');
                                        $.alert({
                                            title: false,
                                            content: 'Solicitação não efetuada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });
                                    }
                                });
                            }
                        });
                    }else{
                        generateModalAlert("Horário Indisponível!");
                        $('#mymodal').modal('show');

                    }
                } else {
                    var dia = start.toString().substr(4, 12);
                    var diaformat = dia.split(" ");
                    var day = diaformat[1];
                    var mes = diaformat[0];
                    var mesnumero = mes;
                    switch (mesnumero) {
                        case 'Jan' :
                            mesnumero = "01";
                            break;
                        case 'Fev' :
                            mesnumero = "02";
                            break;
                        case 'Mar' :
                            mesnumero = "03";
                            break;
                        case 'Abr' :
                            mesnumero = "04";
                            break;
                        case 'Mai' :
                            mesnumero = "05";
                            break;
                        case 'Jun' :
                            mesnumero = "06";
                            break;
                        case 'Jul' :
                            mesnumero = "07";
                            break;
                        case 'Ago' :
                            mesnumero = "08";
                            break;
                        case 'Set' :
                            mesnumero = "09";
                            break;
                        case 'Out' :
                            mesnumero = "10";
                            break;
                        case 'Nov' :
                            mesnumero = "11";
                            break;
                        case 'Dez' :
                            mesnumero = "12";
                            break;
                    }


                    switch (mes) {
                        case 'Jan' :
                            mes = "janeiro";
                            break;
                        case 'Fev' :
                            mes = "fevereiro";
                            break;
                        case 'Mar' :
                            mes = "março";
                            break;
                        case 'Abr' :
                            mes = "abril";
                            break;
                        case 'Mai' :
                            mes = "maio";
                            break;
                        case 'Jun' :
                            mes = "junho";
                            break;
                        case 'Jul' :
                            mes = "julho";
                            break;
                        case 'Ago' :
                            mes = "agosto";
                            break;
                        case 'Set' :
                            mes = "setembro";
                            break;
                        case 'Out' :
                            mes = "outubro";
                            break;
                        case 'Nov' :
                            mes = "novembro";
                            break;
                        case 'Dez' :
                            mes = "dezembro";
                            break;
                    }
                    var ano = diaformat[2];
                    var hora = start.toString().substr(16, 5);

                    var horastime = hora.substr(0, 2);

                    var minutestimes = hora.substr(3, 4);


                    var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                    var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);


                    var horastempo = Math.floor(minutostotais / 60);

                    var minutostempo = ((minutostotais % 60)).toFixed(2);

                    var str_minutos = new String(Math.floor(minutostempo));


                    if (str_minutos.length < 2) {
                        str_minutos = 0 + str_minutos;
                    }
                    var endtimeevent = (horastempo + ":" + str_minutos);
                    endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                    endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));
                    var title = $.confirm({
                        title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                        content: false,
                        animation: 'zoom',
                        closeAnimation: 'scale',
                        animationBounce: 1.5,
                        theme: 'supervan',
                        confirmButton: 'Sim',
                        cancelButton: 'Não',
                        keyboardEnabled: true,

                        confirm: function () {

                            var eventData;
                            eventData = {
                                title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                start: start,
                                end: endtimeformat,
                                backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                Color: 'rgba(36, 151, 172, 0.70)',
                                borderColor: 'transparent',
                                id: start
                            };


                            $('#calendar').fullCalendar('renderEvent', eventData, true);
                            var clientname = $.cookieStorage.get('User').name;
                            var clientid = $.cookieStorage.get('User').id;
                            var service = subclass_name;
                            var serviceid = subclass_id;
                            var minutes = eventData.start._d.getMinutes();
                            var hour = eventData.start._d.getUTCHours();

                            str_horas = new String(hour);
                            str_minutos = new String(minutes);

                            if (str_horas.length < 2) {
                                hour = 0 + str_horas;
                            }
                            if (str_minutos.length < 2) {
                                minutes = 0 + str_minutos;
                            }

                            var time = hour + ":" + minutes;
                            var month = new Array();
                            month[0] = '01';
                            month[1] = '02';
                            month[2] = '03';
                            month[3] = '04';
                            month[4] = '05';
                            month[5] = '06';
                            month[6] = '07';
                            month[7] = '08';
                            month[8] = '09';
                            month[9] = '10';
                            month[10] = '11';
                            month[11] = '12';
                            var n = month[eventData.start._d.getMonth()];
                            var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                            var status = 'WAITING_COMPANY_RESPONSE';
                            var today = new Date();
                            var i = month[today.getMonth()];
                            var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();

                            endtimeevent = endtimeevent.split(":");
                            var endvar = (endtimeevent[0] + ":");
                            var endmin = endtimeevent[1];

                            var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "','WAITING_COMPANY_RESPONSE'," + professional_id1 + ", " + voucher_id + ");";


                            var conditions4 = {
                                'General': {
                                    'query': query4
                                }
                            };
                            var postData4 = JSON.stringify(conditions4);

                            postData4 = {
                                'params': postData4
                            };
                            var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                            $.ajax({
                                method: "POST",
                                url: url4,
                                data: postData4

                            }).done(function (resultado) {


                                if (resultado == "ImE6MDp7fSI=") {
                                    $.alert({
                                        title: "",
                                        content: 'Solicitação Enviada!',
                                        animation: 'zoom',
                                        closeAnimation: 'scale',
                                        animationBounce: 1.5,
                                        theme: 'supervan',
                                        closeIcon: false,
                                        confirmButton: false,
                                        backgroundDismiss: true
                                    });

                                } else {
                                    $('#calendar').fullCalendar('unselect');
                                    $.alert({
                                        title: false,
                                        content: 'Solicitação não efetuada!',
                                        animation: 'zoom',
                                        closeAnimation: 'scale',
                                        animationBounce: 1.5,
                                        theme: 'supervan',
                                        closeIcon: false,
                                        confirmButton: false,
                                        backgroundDismiss: true
                                    });
                                }


                            });
                        }
                    });
                }
            }
            }
        },

        minTime:abertura,
        maxTime:fechamento,
        //DEFINE SE OS FINAIS DE SEMANA SÃO SELECIONÁVEIS weekends:false,
        slotLabelFormat: 'H(:mm) a',
        allDaySlot: false,
        defaultView: 'agendaDay',
        editable: false,
        eventLimit: true, // allow "more" link when too many events
        events: [
            text
        ]

    });
    verificaData();
    $("#btnright-single-arrow").click(function (){
        verificaData();


    });
    $("#btnleft-single-arrow").click(function (){
        verificaData();


    });


}

 function createCalendar2(text){
     var domingo = '';
     var segunda = '';
     var terca = '';
     var quarta = '';
     var quinta = '';
     var sexta = '';
     var sabado = '';
     var separado = resultado2.split(',');
     if(separado[0]!= undefined){
         domingo = separado[0]/1;
     } if(separado[1]!= undefined){
         segunda = separado[1]/1;
     } if(separado[2]!= undefined){
         terca = separado[2]/1;
     }if(separado[3]!= undefined){
         quarta = separado[3]/1;
     } if(separado[4]!= undefined){
         quinta = separado[4]/1;
     } if(separado[5]!= undefined){
         sexta = separado[5]/1;
     } if(separado[6]!= undefined){
         sabado = separado[6]/1;
     }
     var defaultdate = moment(new Date);

     $('#calendar').fullCalendar({

                header: {
                    left: 'prev',
                    center:'title',
                    right:'next'
                },
                hiddenDays: [domingo, segunda, terca, quarta, quinta, sexta, sabado],
                defaultDate: defaultdate,
                selectable: true,
                selectHelper: true,

                eventClick: function(event, element) {

                    if(event.title == "HORÁRIO INDISPONÍVEL"){

                        return false;

                    } else {

                        $.confirm({
                            title: 'Excluir solicitação de agendamento de ' + subclass_name + '?',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {
                                event.title = "Cancelado";
                                event.status = "CANCELED_BY_USER";
                                //REMOVER EVENTO
                                $('#calendar').fullCalendar('removeEvents', event.id);
                                $.alert({
                                    title: "",
                                    content: 'Solicitação excluida!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true
                                });

                                var query4 = "SELECT * FROM schedules_solicitation WHERE user_id = " + $.cookieStorage.get('User').id + " and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                    if (result != "ImE6MDp7fSI=") {
                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));
                                        for (var j = 0; j < convertedReturns4.length; j++) {
                                            var cancelar = convertedReturns4[j].ScheduleSolicitation.time_begin;
                                            var user = convertedReturns4[j].ScheduleSolicitation.user_id;


                                            var start = event.start;
                                            var hora = start.toString().substr(16, 5);
                                            var data = start.toString().substr(0,15);
                                            var ano = data.substr(11,15);
                                            var mes =  data.substr(4,3);
                                            switch (mes) {
                                                case 'Jan' :
                                                    mes = "01";
                                                    break;
                                                case 'Fev' :
                                                    mes = "02";
                                                    break;
                                                case 'Mar' :
                                                    mes = "03";
                                                    break;
                                                case 'Abr' :
                                                    mes = "04";
                                                    break;
                                                case 'Mai' :
                                                    mes = "05";
                                                    break;
                                                case 'Jun' :
                                                    mes = "06";
                                                    break;
                                                case 'Jul' :
                                                    mes = "07";
                                                    break;
                                                case 'Ago' :
                                                    mes = "08";
                                                    break;
                                                case 'Set' :
                                                    mes = "09";
                                                    break;
                                                case 'Out' :
                                                    mes = "10";
                                                    break;
                                                case 'Nov' :
                                                    mes = "11";
                                                    break;
                                                case 'Dez' :
                                                    mes = "12";
                                                    break;
                                            }

                                            var dia = start.toString().substr(8,2);
                                            if (user == $.cookieStorage.get('User').id && cancelar == hora+":00") {
                                                var query4 = "UPDATE schedules_solicitation SET status = 'CANCELLED_BY_USER' WHERE time_begin ='"+hora+":00' and date ='"+ano+"-"+mes+"-"+dia+"' and secundary_user_id ="+professional_id1+" and company_id = " + company_id;

                                                var conditions4 = {
                                                    'General': {
                                                        'query': query4
                                                    }
                                                };
                                                var postData4 = JSON.stringify(conditions4);

                                                postData4 = {
                                                    'params': postData4
                                                };
                                                var url4 = 'http://'+ip+'/api/General/get/query/' + createToken();

                                                $.ajax({
                                                    method: "POST",
                                                    url: url4,
                                                    data: postData4

                                                }).done(function (result) {
                                                    if (result != "ImE6MDp7fSI=") {
                                                        var objReturns4 = JSON.parse(JSON.stringify(result));
                                                        var decodeObjReturns4 = Base64.decode(objReturns4);
                                                        var convertedReturns4 = unserialize(JSON.parse(decodeObjReturns4));

                                                    }
                                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                                    alert(errorThrown);
                                                });
                                                //MUDAR STATUS DO ARQUIVO ARQUIVO DO BANCO DE DADOS

                                            }
                                        }
                                    }
                                }).error(function (XMLHttpRequest, textStatus, errorThrown) {
                                    alert(errorThrown);
                                });



                            },
                            cancel: function () {

                                $.alert({
                                    title: false,
                                    content: 'Operação Cancelada!',
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    closeIcon: false,
                                    confirmButton: false,
                                    backgroundDismiss: true

                                })

                            }

                        });

                    }

                },
                select: function(start, end) {
                    if(moment(start)>moment(new Date)){

                        var dia = start.toString().substr(4, 12);
                        var diaformat = dia.split(" ");
                        var day = diaformat[1];
                        var mes = diaformat[0];
                        var mesnumero = mes;
                        switch (mesnumero) {
                            case 'Jan' :
                                mesnumero = "01";
                                break;
                            case 'Fev' :
                                mesnumero = "02";
                                break;
                            case 'Mar' :
                                mesnumero = "03";
                                break;
                            case 'Abr' :
                                mesnumero = "04";
                                break;
                            case 'Mai' :
                                mesnumero = "05";
                                break;
                            case 'Jun' :
                                mesnumero = "06";
                                break;
                            case 'Jul' :
                                mesnumero = "07";
                                break;
                            case 'Ago' :
                                mesnumero = "08";
                                break;
                            case 'Set' :
                                mesnumero = "09";
                                break;
                            case 'Out' :
                                mesnumero = "10";
                                break;
                            case 'Nov' :
                                mesnumero = "11";
                                break;
                            case 'Dez' :
                                mesnumero = "12";
                                break;
                        }


                        switch (mes) {
                            case 'Jan' :
                                mes = "janeiro";
                                break;
                            case 'Fev' :
                                mes = "fevereiro";
                                break;
                            case 'Mar' :
                                mes = "março";
                                break;
                            case 'Abr' :
                                mes = "abril";
                                break;
                            case 'Mai' :
                                mes = "maio";
                                break;
                            case 'Jun' :
                                mes = "junho";
                                break;
                            case 'Jul' :
                                mes = "julho";
                                break;
                            case 'Ago' :
                                mes = "agosto";
                                break;
                            case 'Set' :
                                mes = "setembro";
                                break;
                            case 'Out' :
                                mes = "outubro";
                                break;
                            case 'Nov' :
                                mes = "novembro";
                                break;
                            case 'Dez' :
                                mes = "dezembro";
                                break;
                        }
                        var ano = diaformat[2];
                        var hora = start.toString().substr(16, 5);

                        var horastime = hora.substr(0, 2);

                        var minutestimes = hora.substr(3, 4);


                        var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                        var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                        var horastempo = Math.floor(minutostotais / 60);
                        var minutostempo = ((minutostotais % 60)).toFixed(2);
                        var str_minutos = new String(Math.floor(minutostempo));
                        if (str_minutos.length < 2) {
                            str_minutos = 0 + str_minutos;
                        }
                        var endtimeevent = (horastempo + ":" + str_minutos);
                        endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                        endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));

                        var title = $.confirm({
                            title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                            content: false,
                            animation: 'zoom',
                            closeAnimation: 'scale',
                            animationBounce: 1.5,
                            theme: 'supervan',
                            confirmButton: 'Sim',
                            cancelButton: 'Não',
                            keyboardEnabled: true,

                            confirm: function () {

                                var eventData;
                                eventData = {
                                    title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                    start: start,
                                    end: endtimeformat,
                                    backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                    Color: 'rgba(36, 151, 172, 0.70)',
                                    borderColor: 'transparent',
                                    id: start
                                };


                                $('#calendar').fullCalendar('renderEvent', eventData, true);
                                var clientname = $.cookieStorage.get('User').name;
                                var clientid = $.cookieStorage.get('User').id;
                                var service = subclass_name;
                                var serviceid = subclass_id;
                                var minutes = eventData.start._d.getMinutes();
                                var hour = eventData.start._d.getUTCHours();

                                str_horas = new String(hour);
                                str_minutos = new String(minutes);

                                if (str_horas.length < 2) {
                                    hour = 0 + str_horas;
                                }
                                if (str_minutos.length < 2) {
                                    minutes = 0 + str_minutos;
                                }

                                var time = hour + ":" + minutes;
                                var month = new Array();
                                month[0] = '01';
                                month[1] = '02';
                                month[2] = '03';
                                month[3] = '04';
                                month[4] = '05';
                                month[5] = '06';
                                month[6] = '07';
                                month[7] = '08';
                                month[8] = '09';
                                month[9] = '10';
                                month[10] = '11';
                                month[11] = '12';
                                var n = month[eventData.start._d.getMonth()];
                                var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                var status = 'WAITING_COMPANY_RESPONSE';
                                var today = new Date();
                                var i = month[today.getMonth()];
                                var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                endtimeevent = endtimeevent.split(":");
                                var endvar = (endtimeevent[0] + ":");
                                var endmin = endtimeevent[1];
                                var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "','WAITING_COMPANY_RESPONSE'," + professional_id1 + ", " + voucher_id + ");";


                                var conditions4 = {
                                    'General': {
                                        'query': query4
                                    }
                                };
                                var postData4 = JSON.stringify(conditions4);

                                postData4 = {
                                    'params': postData4
                                };
                                var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                $.ajax({
                                    method: "POST",
                                    url: url4,
                                    data: postData4

                                }).done(function (result) {
                                    //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                    if (result == "ImE6MDp7fSI=") {
                                        $.alert({
                                            title: "",
                                            content: 'Solicitação Enviada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });

                                    } else {
                                        $('#calendar').fullCalendar('unselect');
                                        $.alert({
                                            title: false,
                                            content: 'Solicitação não efetuada!',
                                            animation: 'zoom',
                                            closeAnimation: 'scale',
                                            animationBounce: 1.5,
                                            theme: 'supervan',
                                            closeIcon: false,
                                            confirmButton: false,
                                            backgroundDismiss: true
                                        });
                                    }
                                });
                            }
                        });
                    }else{

                    if(moment(start).hour()<(moment(new Date).hour())){
                        generateModalAlert("Horário Indisponível!");
                        $('#mymodal').modal('show');

                    }else {
                        if (moment(start).hour() == (moment(new Date).hour())) {
                            if (moment(start).minutes()>(moment(new Date).minutes())) {

                                var dia = start.toString().substr(4, 12);
                                var diaformat = dia.split(" ");
                                var day = diaformat[1];
                                var mes = diaformat[0];
                                var mesnumero = mes;
                                switch (mesnumero) {
                                    case 'Jan' :
                                        mesnumero = "01";
                                        break;
                                    case 'Fev' :
                                        mesnumero = "02";
                                        break;
                                    case 'Mar' :
                                        mesnumero = "03";
                                        break;
                                    case 'Abr' :
                                        mesnumero = "04";
                                        break;
                                    case 'Mai' :
                                        mesnumero = "05";
                                        break;
                                    case 'Jun' :
                                        mesnumero = "06";
                                        break;
                                    case 'Jul' :
                                        mesnumero = "07";
                                        break;
                                    case 'Ago' :
                                        mesnumero = "08";
                                        break;
                                    case 'Set' :
                                        mesnumero = "09";
                                        break;
                                    case 'Out' :
                                        mesnumero = "10";
                                        break;
                                    case 'Nov' :
                                        mesnumero = "11";
                                        break;
                                    case 'Dez' :
                                        mesnumero = "12";
                                        break;
                                }


                                switch (mes) {
                                    case 'Jan' :
                                        mes = "janeiro";
                                        break;
                                    case 'Fev' :
                                        mes = "fevereiro";
                                        break;
                                    case 'Mar' :
                                        mes = "março";
                                        break;
                                    case 'Abr' :
                                        mes = "abril";
                                        break;
                                    case 'Mai' :
                                        mes = "maio";
                                        break;
                                    case 'Jun' :
                                        mes = "junho";
                                        break;
                                    case 'Jul' :
                                        mes = "julho";
                                        break;
                                    case 'Ago' :
                                        mes = "agosto";
                                        break;
                                    case 'Set' :
                                        mes = "setembro";
                                        break;
                                    case 'Out' :
                                        mes = "outubro";
                                        break;
                                    case 'Nov' :
                                        mes = "novembro";
                                        break;
                                    case 'Dez' :
                                        mes = "dezembro";
                                        break;
                                }
                                var ano = diaformat[2];
                                var hora = start.toString().substr(16, 5);

                                var horastime = hora.substr(0, 2);

                                var minutestimes = hora.substr(3, 4);


                                var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                                var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                                var horastempo = Math.floor(minutostotais / 60);
                                var minutostempo = ((minutostotais % 60)).toFixed(2);
                                var str_minutos = new String(Math.floor(minutostempo));
                                if (str_minutos.length < 2) {
                                    str_minutos = 0 + str_minutos;
                                }
                                var endtimeevent = (horastempo + ":" + str_minutos);
                                endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                                endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));
                                var title = $.confirm({
                                    title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                                    content: false,
                                    animation: 'zoom',
                                    closeAnimation: 'scale',
                                    animationBounce: 1.5,
                                    theme: 'supervan',
                                    confirmButton: 'Sim',
                                    cancelButton: 'Não',
                                    keyboardEnabled: true,

                                    confirm: function () {

                                        var eventData;
                                        eventData = {
                                            title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                            start: start,
                                            end: endtimeformat,
                                            backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                            Color: 'rgba(36, 151, 172, 0.70)',
                                            borderColor: 'transparent',
                                            id: start
                                        };

                                        $('#calendar').fullCalendar('renderEvent', eventData, true);
                                        var clientname = $.cookieStorage.get('User').name;
                                        var clientid = $.cookieStorage.get('User').id;
                                        var service = subclass_name;
                                        var serviceid = subclass_id;
                                        var minutes = eventData.start._d.getMinutes();
                                        var hour = eventData.start._d.getUTCHours();

                                        str_horas = new String(hour);
                                        str_minutos = new String(minutes);

                                        if (str_horas.length < 2) {
                                            hour = 0 + str_horas;
                                        }
                                        if (str_minutos.length < 2) {
                                            minutes = 0 + str_minutos;
                                        }

                                        var time = hour + ":" + minutes;
                                        var month = new Array();
                                        month[0] = '01';
                                        month[1] = '02';
                                        month[2] = '03';
                                        month[3] = '04';
                                        month[4] = '05';
                                        month[5] = '06';
                                        month[6] = '07';
                                        month[7] = '08';
                                        month[8] = '09';
                                        month[9] = '10';
                                        month[10] = '11';
                                        month[11] = '12';
                                        var n = month[eventData.start._d.getMonth()];
                                        var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                        var status = 'WAITING_COMPANY_RESPONSE';
                                        var today = new Date();
                                        var i = month[today.getMonth()];
                                        var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                        endtimeevent = endtimeevent.split(":");
                                        var endvar = " ";
                                        if (endtimeevent < 3) {
                                            endvar = (endtimeevent[0] + ":00:");
                                        } else {
                                            endvar = (endtimeevent[0] + ":" + endtimeevent[1] + ":");
                                        }

                                        var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "', 'WAITING_COMPANY_RESPONSE', " + professional_id1 + "," + voucher_id + " );";
                                     var conditions4 = {
                                            'General': {
                                                'query': query4
                                            }
                                        };
                                        var postData4 = JSON.stringify(conditions4);

                                        postData4 = {
                                            'params': postData4
                                        };
                                        var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                        $.ajax({
                                            method: "POST",
                                            url: url4,
                                            data: postData4

                                        }).done(function (result) {
                                            //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                            if (result == "ImE6MDp7fSI=") {
                                                $.alert({
                                                    title: "",
                                                    content: 'Solicitação Enviada!',
                                                    animation: 'zoom',
                                                    closeAnimation: 'scale',
                                                    animationBounce: 1.5,
                                                    theme: 'supervan',
                                                    closeIcon: false,
                                                    confirmButton: false,
                                                    backgroundDismiss: true
                                                });
                                                window.location.href("home.html")
                                            } else {
                                                $('#calendar').fullCalendar('unselect');
                                                $.alert({
                                                    title: false,
                                                    content: 'Solicitação não efetuada!',
                                                    animation: 'zoom',
                                                    closeAnimation: 'scale',
                                                    animationBounce: 1.5,
                                                    theme: 'supervan',
                                                    closeIcon: false,
                                                    confirmButton: false,
                                                    backgroundDismiss: true
                                                });
                                            }
                                        });
                                    }
                                });
                            }else{
                                generateModalAlert("Horário Indisponível!");
                                $('#mymodal').modal('show');

                            }
                        } else {
                            var dia = start.toString().substr(4, 12);
                            var diaformat = dia.split(" ");
                            var day = diaformat[1];
                            var mes = diaformat[0];
                            var mesnumero = mes;
                            switch (mesnumero) {
                                case 'Jan' :
                                    mesnumero = "01";
                                    break;
                                case 'Fev' :
                                    mesnumero = "02";
                                    break;
                                case 'Mar' :
                                    mesnumero = "03";
                                    break;
                                case 'Abr' :
                                    mesnumero = "04";
                                    break;
                                case 'Mai' :
                                    mesnumero = "05";
                                    break;
                                case 'Jun' :
                                    mesnumero = "06";
                                    break;
                                case 'Jul' :
                                    mesnumero = "07";
                                    break;
                                case 'Ago' :
                                    mesnumero = "08";
                                    break;
                                case 'Set' :
                                    mesnumero = "09";
                                    break;
                                case 'Out' :
                                    mesnumero = "10";
                                    break;
                                case 'Nov' :
                                    mesnumero = "11";
                                    break;
                                case 'Dez' :
                                    mesnumero = "12";
                                    break;
                            }


                            switch (mes) {
                                case 'Jan' :
                                    mes = "janeiro";
                                    break;
                                case 'Fev' :
                                    mes = "fevereiro";
                                    break;
                                case 'Mar' :
                                    mes = "março";
                                    break;
                                case 'Abr' :
                                    mes = "abril";
                                    break;
                                case 'Mai' :
                                    mes = "maio";
                                    break;
                                case 'Jun' :
                                    mes = "junho";
                                    break;
                                case 'Jul' :
                                    mes = "julho";
                                    break;
                                case 'Ago' :
                                    mes = "agosto";
                                    break;
                                case 'Set' :
                                    mes = "setembro";
                                    break;
                                case 'Out' :
                                    mes = "outubro";
                                    break;
                                case 'Nov' :
                                    mes = "novembro";
                                    break;
                                case 'Dez' :
                                    mes = "dezembro";
                                    break;
                            }
                            var ano = diaformat[2];
                            var hora = start.toString().substr(16, 5);

                            var horastime = hora.substr(0, 2);

                            var minutestimes = hora.substr(3, 4);


                            var horaseminutessoma = (horastime * 60) / 1 + (minutestimes / 1);

                            var minutostotais = (horaseminutessoma / 1) + (servicetime / 1);

                            var horastempo = Math.floor(minutostotais / 60);
                            var minutostempo = ((minutostotais % 60)).toFixed(2);
                            var str_minutos = new String(Math.floor(minutostempo));
                            if (str_minutos.length < 2) {
                                str_minutos = 0 + str_minutos;
                            }
                            var endtimeevent = (horastempo + ":" + str_minutos);
                            endtimeformat = (ano + '-' + mesnumero + '-' + day + " " + endtimeevent);
                            endtimeformat = ((moment(endtimeformat, "YYYY-MM-DD HH:mm")));
                            var title = $.confirm({
                                title: 'Solicitar agendamento de ' + subclass_name + ' com ' + professional_id + ' para ' + day + ' de ' + mes + ' às ' + hora + '?',
                                content: false,
                                animation: 'zoom',
                                closeAnimation: 'scale',
                                animationBounce: 1.5,
                                theme: 'supervan',
                                confirmButton: 'Sim',
                                cancelButton: 'Não',
                                keyboardEnabled: true,

                                confirm: function () {

                                    var eventData;
                                    eventData = {
                                        title: subclass_name + ' - SOLICITAÇÃO EM ANDAMENTO',
                                        start: start,
                                        end: endtimeformat,
                                        backgroundColor: 'rgba(36, 151, 172, 0.70)',
                                        Color: 'rgba(36, 151, 172, 0.70)',
                                        borderColor: 'transparent',
                                        id: start
                                    };

                                    $('#calendar').fullCalendar('renderEvent', eventData, true);
                                    var clientname = $.cookieStorage.get('User').name;
                                    var clientid = $.cookieStorage.get('User').id;
                                    var service = subclass_name;
                                    var serviceid = subclass_id;
                                    var minutes = eventData.start._d.getMinutes();
                                    var hour = eventData.start._d.getUTCHours();

                                    str_horas = new String(hour);
                                    str_minutos = new String(minutes);

                                    if (str_horas.length < 2) {
                                        hour = 0 + str_horas;
                                    }
                                    if (str_minutos.length < 2) {
                                        minutes = 0 + str_minutos;
                                    }

                                    var time = hour + ":" + minutes;
                                    var month = new Array();
                                    month[0] = '01';
                                    month[1] = '02';
                                    month[2] = '03';
                                    month[3] = '04';
                                    month[4] = '05';
                                    month[5] = '06';
                                    month[6] = '07';
                                    month[7] = '08';
                                    month[8] = '09';
                                    month[9] = '10';
                                    month[10] = '11';
                                    month[11] = '12';
                                    var n = month[eventData.start._d.getMonth()];
                                    var date = eventData.start._d.getUTCDate() + "/" + n + "/" + eventData.start._d.getUTCFullYear();
                                    var status = 'WAITING_COMPANY_RESPONSE';
                                    var today = new Date();
                                    var i = month[today.getMonth()];
                                    var StringToday = today.getDate() + "/" + i + "/" + today.getFullYear();
                                    endtimeevent = endtimeevent.split(":");
                                    var endvar = " ";
                                    if (endtimeevent < 3) {
                                        endvar = (endtimeevent[0] + ":00:");
                                    } else {
                                        endvar = (endtimeevent[0] + ":" + endtimeevent[1] + ":");
                                    }

                                    var query4 = "INSERT INTO schedules_solicitation (user_id, user_name, service_name, service_id, company_id, time_begin, time_end, date, date_solicitation, status, secundary_user_id, voucher_id) VALUES (" + $.cookieStorage.get('User').id + ",'" + $.cookieStorage.get('User').name + "','" + service + "'," + serviceid + "," + company_id + ",'" + hour + ":" + minutes + ":00','" + endvar + "" + endmin + ":00','" + eventData.start._d.getUTCFullYear() + "-" + n + "-" + eventData.start._d.getUTCDate() + "', '" + today.getFullYear() + "-" + i + "-" + today.getDate() + "', 'WAITING_COMPANY_RESPONSE', " + professional_id1 + "," + voucher_id + " );";

                                    var conditions4 = {
                                        'General': {
                                            'query': query4
                                        }
                                    };
                                    var postData4 = JSON.stringify(conditions4);

                                    postData4 = {
                                        'params': postData4
                                    };
                                    var url4 = 'http://' + ip + '/api/General/get/query/' + createToken();

                                    $.ajax({
                                        method: "POST",
                                        url: url4,
                                        data: postData4

                                    }).done(function (result) {
                                        //MEXER AQUI, VERIFICAR SE FOI GRAVADO NO BANCO E EXIBIR MODAL COM RESULTADO;
                                        if (result == "ImE6MDp7fSI=") {
                                            $.alert({
                                                title: "",
                                                content: 'Solicitação Enviada!',
                                                animation: 'zoom',
                                                closeAnimation: 'scale',
                                                animationBounce: 1.5,
                                                theme: 'supervan',
                                                closeIcon: false,
                                                confirmButton: false,
                                                backgroundDismiss: true
                                            });
                                            window.location.href("home.html")
                                        } else {
                                            $('#calendar').fullCalendar('unselect');
                                            $.alert({
                                                title: false,
                                                content: 'Solicitação não efetuada!',
                                                animation: 'zoom',
                                                closeAnimation: 'scale',
                                                animationBounce: 1.5,
                                                theme: 'supervan',
                                                closeIcon: false,
                                                confirmButton: false,
                                                backgroundDismiss: true
                                            });
                                        }
                                    });
                                }
                            });
                        }
                    }
                    }
                },

                minTime:abertura,
               maxTime:fechamento,
                //DEFINE SE OS FINAIS DE SEMANA SÃO SELECIONÁVEIS weekends:false,
                slotLabelFormat: 'H(:mm) a',
                allDaySlot:false,
                defaultView: 'agendaDay',
                editable: false,
                eventLimit: true, // allow "more" link when too many events
                events:[]


            });




    $("#btnright-single-arrow").click(function (){
        verificaData();


    });
    $("#btnleft-single-arrow").click(function (){
        verificaData();


    });

     verificaData();

        }


        $('#calendar').fullCalendar({
            height: 100
        });


        function createToken() {
            var arraySend = {
                'secureNumbers': Math.floor(new Date().getTime() / 1000)
            };
            var json = JSON.stringify(arraySend);
            return Base64.encode(json);
        }



        $(document).ready(function() {

            if($.cookieStorage.get('Vouchers')!= null){
                voucher_id = $.cookieStorage.get('Vouchers').id;
            }else{
                voucher_id = 0 ;
            }
            service_id =  $.cookieStorage.get('services').subclasse_id;
            subclass_id = $.cookieStorage.get('services').id;
            subclass_name = $.cookieStorage.get('subclasses').name;
            document.getElementById("userName").innerText = $.cookieStorage.get('User').name;
            company_id = $.cookieStorage.get('Company').id
            professional_id = $.cookieStorage.get('secondary_users').name;
            professional_id1 = $.cookieStorage.get('secondary_users').id;
            close_hour = $.cookieStorage.get('Company').close_hour;
            open_hour = $.cookieStorage.get('Company').open_hour;

           if($.cookieStorage.get('Company').work_days != null){
            daystoshow = $.cookieStorage.get('Company').work_days;
            daystoshowname = daystoshow.split(",");
            for(var i=0; i<daystoshowname.length;i++){
                daystohide = daystoshowname[i];
                switch (daystohide){
                    case 'dom':
                        daystohide = 0;
                        break;
                    case 'seg':
                        daystohide = 1;
                        break;
                    case 'ter':
                        daystohide = 2;
                        break;
                    case 'qua':
                        daystohide = 3;
                        break;
                    case 'qui':
                        daystohide = 4;
                        break;
                    case 'sex':
                        daystohide = 5;
                        break;
                    case 'sab':
                        daystohide = 6;
                        break;
                }
                dias += daystohide;



            }

               var resultado = '';
                var tamanho = dias.length;

               for(var n=0;n<tamanho;n++){
                   if(n+1<tamanho){
                       resultado += (dias.substr([n],1)+",");
                   }else{
                       resultado += (dias.substr([n],1));
                   }

               }

               for(var b =0;b<weekdays.length;b++){
                   if(resultado.indexOf(weekdays[b]) == -1){
                       diasfaltantes += weekdays[b];
                   }
               }


               var tamanho2 = diasfaltantes.length;

               for(var m=0;m<tamanho2;m++){

                   if(m+1<tamanho2){
                       resultado2 += ((diasfaltantes.substr([m],1)/1)+",");
                   }else{
                       resultado2 += ((diasfaltantes.substr([m],1)/1));
                   }

               }

           }

            str_open = (open_hour.split(":"));
            abertura = (str_open[0]+":"+str_open[1]);
            str_close = (close_hour.split(":"));
            fechamento = (str_close[0]+":"+str_close[1]);
            servicetime = $.cookieStorage.get('services').time;


            sendRequest();

        });
    </script>
    <style>
        body {
            margin: 0px 0px 0px 0px;
            padding: 0.5px;
            font-family: "Open Sans", Helvetica, Arial, Verdana, sans-serif;
            color:#2497AC;
            font-size: 14px;

        }

        #calendar {
            margin-top:5%!important;
            max-width: 800px;
            margin: 0 auto;

        }
    </style>
</head>
<body>
<nav id="myNavmenu" class="navmenu navmenu-default navmenu-fixed-left offcanvas" role="navigation">
    <a class="navmenu-brand" id="userName" href="#">Jezzy</a>
    <ul class="nav navmenu-nav">
        <li><a href="home.html"><img src='img/icons/homeFooterIcon.PNG' class="icon-bar">HOME</a></li>
        <li><a href="my_profile.html"><img src='img/icons/Usuario.png' class="icon-bar">PERFIL</a></li>
        <li class="active"><a href="company_selection.html"  id="calendarServicesOptions2" ><img src='img/icons/calendarFooterIcon.PNG' class="icon-bar">AGENDAR</a></li>
        <li><a href="offer_display.html"><img src='img/icons/offerFooterIcon.PNG' class="icon-bar">OFERTAS</a></li>
        <li><a href="services_history.html"><img src='img/icons/Servicos.png' class="icon-bar">SERVIÇOS REALIZADOS</a></li>
        <li><a href="offer_history.html"><img src='img/icons/cardFooterIcon.PNG' class="icon-bar">COMPRAS REALIZADAS</a></li>
        <li><a href="notifications.html"><img src='img/icons/Sino.png' class="icon-bar">NOTIFICAÇÕES</a></li>
        <li><a href="news.html"><img src='img/icons/feedNoticias.png' class="icon-bar">FEED/NOTÍCIAS</a></li>
        <li><a href="vouchers_list.html"><img src='img/services/Voucher-02.png' class="icon-bar">MEUS VOUCHERS</a></li>
        <li><a onclick="Sair();"><img src='img/icons/Sair%20-%20branco-07.png' class="icon-bar" onclick="Sair();">SAIR</a></li>
    </ul>
</nav>
<div class="navbar navbar-default navbar-fixed-top centerLogoJezzy" style="margin-bottom:0%; line-height: 10%; min-height:6%;">
            <span class="centerLogo">
                <img src="img/icons/logo_login.PNG" class="marginTop5 sizeLogo" />
            </span>
    <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target="#myNavmenu" data-canvas="body">
        <img src="img/icons/Menu.png" class="menu" id="menu"/>
    </button>
            <span class="iconSearchJezzy" id="notify">
                <img src="img/icons/Sino.png" class="menu marginTop5" id="UserLink" />
            </span>
    <div class="bottomLine"></div>
</div>
<div class="firstLine col-md-12" style="font-size:5vw;">
        <img src="img/icons/Chevron%20dourado.png" onclick="voltar(); " class="btn1 icone col-md-2" style="font-size:5vw; margin-top:0px; vertical-align: middle;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELECIONE UMA DATA
    </div>

<div id="calendar" class="fc fc-ltr fc-unthemed">

</div>



</body>
</html>